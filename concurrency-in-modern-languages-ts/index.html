<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="icon" href="/assets/images/logo.png"><title>Concurrency in modern programming languages: TypeScript on Deno | Technorage</title><meta name="generator" content="Jekyll v4.1.1"><meta property="og:title" content="Concurrency in modern programming languages: TypeScript on Deno"><meta name="author" content="deepu"><meta property="og:locale" content="en_US"><meta name="description" content="Building a concurrent web server in TypeScript on Deno to compare concurrency performance with Rust, Go, JS, Kotlin, and Java"><meta property="og:description" content="Building a concurrent web server in TypeScript on Deno to compare concurrency performance with Rust, Go, JS, Kotlin, and Java"><link rel="canonical" href="https://deepu.tech/concurrency-in-modern-languages-ts/"><meta property="og:url" content="https://deepu.tech/concurrency-in-modern-languages-ts/"><meta property="og:site_name" content="Technorage"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-02-19T00:00:00+01:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Concurrency in modern programming languages: TypeScript on Deno"><script type="application/ld+json">{"author":{"@type":"Person","name":"deepu"},"description":"Building a concurrent web server in TypeScript on Deno to compare concurrency performance with Rust, Go, JS, Kotlin, and Java","headline":"Concurrency in modern programming languages: TypeScript on Deno","dateModified":"2021-02-19T00:00:00+01:00","datePublished":"2021-02-19T00:00:00+01:00","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://deepu.tech/assets/images/logo.png"},"name":"deepu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://deepu.tech/concurrency-in-modern-languages-ts/"},"url":"https://deepu.tech/concurrency-in-modern-languages-ts/","@context":"https://schema.org"}</script><link rel="canonical" href="https://deepu.tech/concurrency-in-modern-languages-ts/"><meta property="og:url" content=""><meta name="monetization" content="$ilp.uphold.com/Aw7eGpxKNyK7"><meta name="twitter:site" content="@deepu105"><meta name="twitter:creator" content="@deepu105"><meta name="twitter:title" content="Concurrency in modern programming languages: TypeScript on Deno"><meta name="twitter:description" content="Building a concurrent web server in TypeScript on Deno to compare concurrency performance with Rust, Go, JS, Kotlin, and Java"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://i.imgur.com/zIc76rV.jpg"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y=" crossorigin="anonymous"><link href="/assets/css/screen.css" rel="stylesheet"><link href="/assets/css/main.css" rel="stylesheet"></head><body class="layout-post"><noscript id="deferred-styles"><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css" crossorigin="anonymous"></noscript><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down pr-md-0 pl-md-0"><div class="container d-flex align-items-center"><a class="navbar-brand" href="/"><h2>Deepu K Sasidharan</h2></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarMediumish"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link" href="/">About</a></li><li class="nav-item active"><a class="nav-link" href="/blogs/"><i class="fas fa-blog"></i> Blog</a></li><li class="nav-item"><a class="nav-link" href="/books"><i class="fas fa-book"></i> Books</a></li><li class="nav-item"><a target="_blank" class="nav-link" href="https://www.youtube.com/playlist?list=PLxayiD7e52nPpb-sSaoOPc-zXGhmOaNHK"><i class="fab fa-youtube"></i> Videos</a></li><li class="nav-item"><a target="_blank" class="nav-link" href="https://speakerdeck.com/deepu105"><i class="fab fa-speaker-deck"></i> Presentations</a></li><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js" integrity="sha256-34Si1Y6llMBKM3G0jQILVeoQKEwuxjbk4zGWXXMT4ps=" crossorigin="anonymous"></script><style>.lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}</style><form class="bd-search" onsubmit="return lunr_search(document.getElementById('lunrsearch').value);"><input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."></form><div id="lunrsearchresults"><ul></ul></div><script src="/assets/js/lunrsearchengine.js"></script></ul></div></div></nav><div class="site-content"><div class="container"><div class="main-content"><div class="mainheading"><h1 class="sitetitle">Technorage</h1><p class="lead">Where I rage about technology and stuff!</p></div><div class="container"><div class="row"><div class="col-lg-2 pl-0"><div class="sticky-top sticky-top-offset"><div class="popover-wrapper d-none d-lg-block"><a href="#"><h2 class="popover-title"><i class="fas fa-stream fa-lg"></i> TOC</h2></a><div class="popover-content"><div class="toc lead"><h3 class="font-weight-bold">Summary</h3><ul><li><a href="#">Forget NodeJS! Build native TypeScript applications with Deno ðŸ¦–</a></li><li><a href="#">Concurrency in modern programming languages: JavaScript on NodeJS</a></li><li><a href="#multi-threading">Multi-threading</a></li><li><a href="#asynchronous-processing">Asynchronous processing</a></li><li><a href="#async-http-concurrent-webserver">Async HTTP concurrent webserver</a></li></ul></div></div></div><div class="share"><p>Share</p><ul><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=Concurrency in modern programming languages: TypeScript on Deno by @deepu105 &url=https://deepu.tech/concurrency-in-modern-languages-ts/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/concurrency-in-modern-languages-ts/" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=435');return false;" title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/concurrency-in-modern-languages-ts/&t=Concurrency in modern programming languages: TypeScript on Deno" onclick="window.open(this.href, 'hackernews-share', 'width=550,height=435');return false;" title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/concurrency-in-modern-languages-ts/&title=Concurrency in modern programming languages: TypeScript on Deno" onclick="window.open(this.href, 'reddit-share', 'width=550,height=435');return false;" title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/concurrency-in-modern-languages-ts/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;" title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul><div class="sep"></div><ul><li><a class="small smoothscroll" href="#disqus_thread"></a></li></ul></div><div class="ad-vertical-md"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3I&placement=deeputech" id="_carbonads_js"></script></div></div></div><div class="col-lg-9 flex-first flex-lg-unordered"><div class="mainheading"><h1 class="posttitle">Concurrency in modern programming languages: TypeScript on Deno</h1><img data-src="https://i.imgur.com/zIc76rV.jpg" alt="Concurrency in modern programming languages: TypeScript on Deno" class="featured-image img-fluid lozad" src="/assets/images/placeholder.jpg"><div class="row post-top-meta"><div class="col-12 text-center text-md-left mb-4 mb-md-0"><img class="author-thumb lozad" src="/assets/images/placeholder.jpg" data-src="https://www.gravatar.com/avatar/7f408bc67dc9ae3b288ee92d16d3c4c2?s=250&d=mm&r=x" alt="Deepu K Sasidharan"> <a target="_blank" class="link-dark" href="https://www.deepu.tech">Deepu K Sasidharan</a><a target="_blank" href="https://twitter.com/deepu105" class="btn follow">Follow</a><span class="separator d-none d-md-inline-block">| </span><span class="author-description"><small><time class="post-date" datetime="2021-02-19">19 Feb 2021</time> </small><span class="separator d-inline-block">| </span><small>9 mins read</small> <span class="separator d-inline-block d-lg-none">| </span><span class="d-inline-block d-lg-none"><div class="share" style="margin-top: 0;"><ul><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=Concurrency in modern programming languages: TypeScript on Deno by @deepu105 &url=https://deepu.tech/concurrency-in-modern-languages-ts/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/concurrency-in-modern-languages-ts/" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=435');return false;" title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/concurrency-in-modern-languages-ts/&t=Concurrency in modern programming languages: TypeScript on Deno" onclick="window.open(this.href, 'hackernews-share', 'width=550,height=435');return false;" title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/concurrency-in-modern-languages-ts/&title=Concurrency in modern programming languages: TypeScript on Deno" onclick="window.open(this.href, 'reddit-share', 'width=550,height=435');return false;" title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/concurrency-in-modern-languages-ts/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;" title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul></div></span></span></div></div></div><div class="panel"><p><strong>This is part of my "concurrency in modern programming languages" series</strong></p><ol><li><a href="/concurrency-in-modern-languages/">Concurrency in modern programming languages: Introduction</a></li><li><a href="/concurrency-in-modern-languages-rust/">Concurrency in modern programming languages: Rust</a></li><li><a href="/concurrency-in-modern-languages-go/">Concurrency in modern programming languages: Golang</a></li><li><a href="/concurrency-in-modern-languages-js/">Concurrency in modern programming languages: JavaScript on NodeJS</a></li><li><strong>Concurrency in modern programming languages: TypeScript on Deno</strong></li><li><a href="/concurrency-in-modern-languages-java/">Concurrency in modern programming languages: Java</a></li></ol></div><div class="article-post"><p>Please follow me on <a href="https://twitter.com/deepu105">Twitter</a> for updates and let me know what can be improved in the post.</p><hr><p>This is a multi-part series where Iâ€™ll be talking about concurrency in modern programming languages and will be building and benchmarking a concurrent web server, inspired by the example from the <a href="https://doc.rust-lang.org/book/ch20-00-final-project-a-web-server.html">Rust book</a>, in popular languages like Rust, Go, JavaScript (NodeJS), TypeScript (Deno), Kotlin and Java to compare concurrency and its performance between these languages/platforms. The chapters of this series are as below.</p><ol><li><a href="https://deepu.tech/concurrency-in-modern-languages/">Introduction</a></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-rust/">Concurrent web server in Rust</a></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-go/">Concurrent web server in Golang</a></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-js/">Concurrent web server in JavaScript with NodeJS</a></li><li><strong>Concurrent web server in TypeScript with Deno</strong></li><li>Concurrent web server in Java with JVM</li><li>Concurrent web server in Kotlin with JVM</li><li>Comparison and conclusion of benchmarks</li></ol><p>If you are new to <a href="https://deno.land/">Deno</a>, check this post out to get an idea.</p><div class="link-container"><a href="https://deepu.tech/deno-runtime-for-typescript/"><div class="ltag__link__content"><h3>Forget NodeJS! Build native TypeScript applications with Deno ðŸ¦–</h3><p>18-Feb-2020</p><div class="ltag__link__taglist">#typescript #javascript #nodejs #deno</div></div></a></div><hr><h2 id="concurrency-in-deno">Concurrency in Deno</h2><p>Concurrency in TypeScript is exactly the same as in JavaScript as TypeScript is a strict superset of JavaScript. So I suggest you read the below post first to get an idea of concurrency in JavaScript. Iâ€™ll be covering only the differences between NodeJS and Deno here.</p><div class="link-container"><a href="https://deepu.tech/concurrency-in-modern-languages-js/"><div class="ltag__link__content"><h3>Concurrency in modern programming languages: JavaScript on NodeJS</h3><p>05-Feb-2021</p><div class="ltag__link__taglist">#languages #concurrency #nodejs #javascript</div></div></a></div><p>So if you use TypeScript with NodeJS itâ€™s exactly the same as using JavaScript on NodeJS as NodeJS doesnâ€™t run TypeScript natively and we have to transpile it down to JavaScript so letâ€™s focus on TypeScript on Deno since we already covered NodeJS.</p><p>Unlike NodeJS, Deno can run TypeScript natively, itâ€™s transpiled to JS behind the scenes. As we saw with NodeJS, Deno is also focused on non-blocking IO with an aim of improving/fixing issues in NodeJS. This means you can do everything that you can do with NodeJS and JavaScript on Deno as well, with nicer APIs and less code sometimes. Like in JS you rely on the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop">event loop</a>, <a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function">Callbacks</a>, <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promises</a>, and <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await">Async/Await</a> to achieve concurrency in TypeScript.</p><p>And the Deno APIs are async by default and promote using async/await a lot.</p><blockquote><p>The default for concurrency in Deno is an asynchronous programming model using callbacks, Promise or async/await.</p></blockquote><p>Like in JavaScript, itâ€™s possible to do some level of multi-threaded concurrency and parallelization with TypeScript on Deno as well and since Deno is built on Rust may be in the future concurrency performance might be <a href="https://morioh.com/p/4c492f7f5851">better than</a> that on NodeJS.</p><h3 id="multi-threading">Multi-threading</h3><p>JavaScript is single-threaded hence the only way to achieve multi-threading is by spinning up multiple instances of the JS Engine hence the same goes for TypeScript as well. We looked at the Web Worker API in JS and similar support in NodeJS so when it comes to Deno, it also supports the <a href="https://deno.land/manual@v1.7.4/runtime/workers">Web Worker API</a>.</p><p>This means it is possible to offload heavy computations to a separate thread thus freeing up the main thread. These workers and the main thread communicate using events and a worker thread can spawn other worker threads.</p><p>Unfortunately, Deno doesnâ€™t offer something similar to the NodeJS <a href="https://nodejs.org/dist/latest-v15.x/docs/api/worker_threads.html"><code class="language-plaintext highlighter-rouge">worker_threads</code></a> or the <a href="https://nodejs.org/api/cluster.html#cluster_cluster"><code class="language-plaintext highlighter-rouge">cluster</code></a> module yet and using web workers makes things more complicated as Deno only supports modules as workers, which means you can only invoke a JS/TS file from a worker.</p><p>Hence some of the advanced multi-threading concepts possible in NodeJS is not feasible with Deno yet. Itâ€™s also worth noting that Deno supports Web Assembly out of the box hence paving way for some advanced multi-threading using a language like Rust.</p><h3 id="asynchronous-processing">Asynchronous processing</h3><p>As we saw for NodeJS, Deno is also heavily geared towards non-blocking and asynchronous programming and it improves upon the concepts and makes asynchronous APIs cleaner and easier to use. Deno provides a Promises-based API rather than using callbacks which is a differentiator when compared to NodeJS. Deno even supports concepts like top-level await which reduces clutter and makes the code cleaner.</p><div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1">// sequential (you don't need to wrap this in an async function in Deno)</span>
<span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getUsers</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">posts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getPosts</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">messages</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">getMessages</span><span class="p">();</span>
<span class="c1">// do stuff</span>

<span class="c1">// concurrent (you don't need to wrap this in an async function in Deno)</span>
<span class="kd">const</span> <span class="p">[</span><span class="nx">users</span><span class="p">,</span> <span class="nx">posts</span><span class="p">,</span> <span class="nx">messages</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">getUsers</span><span class="p">(),</span> <span class="nx">getPosts</span><span class="p">(),</span> <span class="nx">getMessages</span><span class="p">()]);</span>
<span class="c1">// do stuff</span>
</pre></td></tr></tbody></table></code></pre></div></div><h2 id="benchmarking">Benchmarking</h2><p>Now that we have some basic understanding of concurrency features in Deno for TypeScript, let us build a simple concurrent web server in TypeScript. Since asynchronous concurrency is the best way to achieve this in Deno weâ€™ll build a sample application using the standard <code class="language-plaintext highlighter-rouge">http</code> module. The Deno version used is the latest (1.7.4) at the time of writing.</p><h3 id="async-http-concurrent-webserver">Async HTTP concurrent webserver</h3><p>This example is closer to the Rust Asynchronous example we built in the <a href="https://deepu.tech/concurrency-in-modern-languages-rust/">second chapter</a>. You can find the full example on <a href="https://github.com/deepu105/concurrency-benchmarks/tree/main/tsws">GitHub here</a>. We are only using standard Deno modules in this case.</p><div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="p">{</span> <span class="nx">serve</span><span class="p">,</span> <span class="nx">ServerRequest</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">https://deno.land/std/http/server.ts</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// set listen port</span>
<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">serve</span><span class="p">({</span> <span class="na">hostname</span><span class="p">:</span> <span class="dl">"</span><span class="s2">0.0.0.0</span><span class="dl">"</span><span class="p">,</span> <span class="na">port</span><span class="p">:</span> <span class="mi">8080</span> <span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">`</span><span class="err">HTTP webserver running at:  http://localhost:8080/</span><span class="s2">`</span><span class="p">);</span>

<span class="c1">// listen to all incoming requests</span>
<span class="k">for</span> <span class="k">await</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">request</span> <span class="k">of</span> <span class="nx">server</span><span class="p">)</span> <span class="nx">handleRequest</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">handleRequest</span><span class="p">(</span><span class="nx">request</span><span class="p">:</span> <span class="nx">ServerRequest</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
  <span class="c1">// add 2 second delay to every 10th request</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Adding delay. Count: </span><span class="dl">"</span><span class="p">,</span> <span class="nx">count</span><span class="p">);</span>
    <span class="k">await</span> <span class="nx">sleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">// read html file</span>
  <span class="kd">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Deno</span><span class="p">.</span><span class="nx">readTextFile</span><span class="p">(</span><span class="dl">"</span><span class="s2">./hello.html</span><span class="dl">"</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">status</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="nx">body</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="k">new</span> <span class="nx">Headers</span><span class="p">(),</span>
  <span class="p">};</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">"</span><span class="s2">Connection</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">keep-alive</span><span class="dl">"</span><span class="p">);</span>
  <span class="nx">request</span><span class="p">.</span><span class="nx">respond</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span> <span class="c1">// send data to client side</span>
<span class="p">}</span>

<span class="c1">// sleep function since NodeJS doesn't provide one</span>
<span class="kd">function</span> <span class="nx">sleep</span><span class="p">(</span><span class="nx">ms</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">ms</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>As you can see we create an HTTP server and bind it to port 8080 and listen to all incoming requests in a for await loop. Each request is processed in a function that internally uses <code class="language-plaintext highlighter-rouge">async/await</code>.</p><p>Let us run a benchmark using ApacheBench. We will make 10000 requests with 100 concurrent requests.</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="rouge-code"><pre>ab <span class="nt">-k</span> <span class="nt">-c</span> 100 <span class="nt">-n</span> 10000 http://127.0.0.1:8080/

This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 1879490 <span class="nv">$&gt;</span>
...

Server Software:
Server Hostname:        127.0.0.1
Server Port:            8080

Document Path:          /
Document Length:        174 bytes

Concurrency Level:      100
Time taken <span class="k">for </span>tests:   21.160 seconds
Complete requests:      10000
Failed requests:        0
Keep-Alive requests:    10000
Total transferred:      2380000 bytes
HTML transferred:       1740000 bytes
Requests per second:    472.59 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       211.600 <span class="o">[</span>ms] <span class="o">(</span>mean<span class="o">)</span>
Time per request:       2.116 <span class="o">[</span>ms] <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          109.84 <span class="o">[</span>Kbytes/sec] received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean[+/-sd] median   max
Connect:        0    0   0.7      0      11
Processing:     0  207 600.7      5    2250
Waiting:        0  207 600.7      5    2250
Total:          0  207 600.7      5    2254

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  50%      5
  66%      8
  75%     11
  80%     13
  90%   2001
  95%   2006
  98%   2012
  99%   2017
 100%   2254 <span class="o">(</span>longest request<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>One minor thing to note is that I had to pass the <code class="language-plaintext highlighter-rouge">-k</code> flag to ApacheBench for this to run all requests. I still couldnâ€™t figure out why it behaves this way. A very similar implementation in every other language worked fine without the flag. So if someone has an idea let me know.</p><h2 id="conclusion">Conclusion</h2><p>As I explained in the <a href="https://deepu.tech/concurrency-in-modern-languages/">first part</a> of this serious, this simple benchmarking is not an accurate representation for all concurrency use cases. Itâ€™s a simple test for a very particular use case, a simple concurrent web server that just serves a file. The idea is to see the differences in solutions and to understand how concurrency works in JavaScript/TypeScript specifically on Deno. And for this particular use case, since there is no clean way to do a multi-threaded server in Deno the <code class="language-plaintext highlighter-rouge">http</code> module provided by the standard library with asynchronous programming seems to be the way to go.</p><p>So stay tuned for the next post where we will look at concurrency in JVM and build the same use case in Java.</p><hr><h2 id="references">References</h2><ul><li><a href="https://morioh.com/p/4c492f7f5851">morioh.com</a></li><li><a href="https://deno.land/">deno.land</a></li></ul><hr><p>If you like this article, please leave a like or a comment.</p><p>You can follow me on <a href="https://twitter.com/deepu105">Twitter</a> and <a href="https://www.linkedin.com/in/deepu05/">LinkedIn</a>.</p><p>Cover image credit: Photo by <a href="https://unsplash.com/@jeffreyfotografie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jeffrey Brandjes</a> on <a href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p><p><em>Also published at <a href="https://dev.to/deepu105/concurrency-in-modern-programming-languages-typescript-on-deno-hkb">Dev.to</a></em></p></div><hr><p>Post <strong>5</strong> of <strong>6</strong> in series <strong>"concurrency in modern programming languages"</strong>.</p><p></p><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" rel="prev" href="/concurrency-in-modern-languages-js/">&laquo; Prev post in series</a> <a class="prev d-block col-md-6 text-right" rel="next" href="/concurrency-in-modern-languages-java/">Next post in series &raquo;</a><div class="clearfix"></div></div><div class="after-post-cats"><ul class="tags mb-4"></ul></div><div class="after-post-tags"><ul class="tags"><li><a class="smoothscroll" href="/tags#concurrency">#concurrency</a></li><li><a class="smoothscroll" href="/tags#deno">#deno</a></li><li><a class="smoothscroll" href="/tags#javascript">#javascript</a></li><li><a class="smoothscroll" href="/tags#typescript">#typescript</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" href="/concurrency-in-modern-languages-js/">&laquo; Concurrency in modern programming languages: JavaScript on NodeJS</a> <a class="next d-block col-md-6 text-lg-right" href="/what-about-svelte/">What about Svelte? Should you care! &raquo;</a><div class="clearfix"></div></div><hr></div></div></div><div class="container"><div id="comments" class="row justify-content-center mb-5"><div class="col-md-8"><section class="disqus"><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'deepu-tech'; 
        var disqus_developer = 0;
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></section></div></div></div></div><div class="alertbar"><div class="container text-center"><span>Never miss a <b>story</b> from us, subscribe to our newsletter</span><form action="https://tech.us7.list-manage.com/subscribe/post?u=00729f6c6d6bb180801b9484e&amp;id=f521dede4b" method="post" name="mc-embedded-subscribe-form" id="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate><div class="mc-field-group"><input type="email" placeholder="Email address" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required> <input type="submit" value="Subscribe" name="subscribe" class="heart"></div></form></div></div></div><div class="jumbotron fortags lozad" data-background-image="/assets/images/jumbotron.jpg"><div class="d-md-flex h-100"><div class="col-md-4 transpdark align-self-center text-center h-100"><div class="d-md-flex align-items-center justify-content-center h-100"><h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">â†’</span></h2></div></div><div class="col-md-8 p-5 align-self-center text-center"><a class="mt-1 mb-1" href="/tags#jhipster">jhipster (3)</a> <a class="mt-1 mb-1" href="/tags#java">java (7)</a> <a class="mt-1 mb-1" href="/tags#microservices">microservices (5)</a> <a class="mt-1 mb-1" href="/tags#docker">docker (2)</a> <a class="mt-1 mb-1" href="/tags#azure">azure (2)</a> <a class="mt-1 mb-1" href="/tags#kubernetes">kubernetes (3)</a> <a class="mt-1 mb-1" href="/tags#typescript">typescript (5)</a> <a class="mt-1 mb-1" href="/tags#react">react (2)</a> <a class="mt-1 mb-1" href="/tags#javascript">javascript (12)</a> <a class="mt-1 mb-1" href="/tags#webdev">webdev (2)</a> <a class="mt-1 mb-1" href="/tags#terraform">terraform (1)</a> <a class="mt-1 mb-1" href="/tags#writing">writing (1)</a> <a class="mt-1 mb-1" href="/tags#medium">medium (1)</a> <a class="mt-1 mb-1" href="/tags#development">development (3)</a> <a class="mt-1 mb-1" href="/tags#tech">tech (1)</a> <a class="mt-1 mb-1" href="/tags#linux">linux (4)</a> <a class="mt-1 mb-1" href="/tags#fedora">fedora (3)</a> <a class="mt-1 mb-1" href="/tags#gnome">gnome (2)</a> <a class="mt-1 mb-1" href="/tags#desktop">desktop (1)</a> <a class="mt-1 mb-1" href="/tags#terminal">terminal (1)</a> <a class="mt-1 mb-1" href="/tags#ohmyzsh">ohmyzsh (1)</a> <a class="mt-1 mb-1" href="/tags#zsh">zsh (1)</a> <a class="mt-1 mb-1" href="/tags#go">go (5)</a> <a class="mt-1 mb-1" href="/tags#programming">programming (14)</a> <a class="mt-1 mb-1" href="/tags#languages">languages (14)</a> <a class="mt-1 mb-1" href="/tags#thepragmaticprogrammer">thepragmaticprogrammer (3)</a> <a class="mt-1 mb-1" href="/tags#vscode">vscode (1)</a> <a class="mt-1 mb-1" href="/tags#ide">ide (1)</a> <a class="mt-1 mb-1" href="/tags#opensource">opensource (1)</a> <a class="mt-1 mb-1" href="/tags#istio">istio (1)</a> <a class="mt-1 mb-1" href="/tags#functional">functional (4)</a> <a class="mt-1 mb-1" href="/tags#beginners">beginners (8)</a> <a class="mt-1 mb-1" href="/tags#showdev">showdev (2)</a> <a class="mt-1 mb-1" href="/tags#ruby">ruby (1)</a> <a class="mt-1 mb-1" href="/tags#Jekyll">Jekyll (1)</a> <a class="mt-1 mb-1" href="/tags#blogging">blogging (1)</a> <a class="mt-1 mb-1" href="/tags#architecture">architecture (1)</a> <a class="mt-1 mb-1" href="/tags#devops">devops (1)</a> <a class="mt-1 mb-1" href="/tags#distributedsystems">distributedsystems (1)</a> <a class="mt-1 mb-1" href="/tags#rust">rust (6)</a> <a class="mt-1 mb-1" href="/tags#bash">bash (1)</a> <a class="mt-1 mb-1" href="/tags#codenewbie">codenewbie (1)</a> <a class="mt-1 mb-1" href="/tags#codequality">codequality (2)</a> <a class="mt-1 mb-1" href="/tags#career">career (2)</a> <a class="mt-1 mb-1" href="/tags#computerscience">computerscience (4)</a> <a class="mt-1 mb-1" href="/tags#motivation">motivation (1)</a> <a class="mt-1 mb-1" href="/tags#books">books (1)</a> <a class="mt-1 mb-1" href="/tags#kotlin">kotlin (1)</a> <a class="mt-1 mb-1" href="/tags#scala">scala (1)</a> <a class="mt-1 mb-1" href="/tags#clojure">clojure (1)</a> <a class="mt-1 mb-1" href="/tags#WebAssembly">WebAssembly (1)</a> <a class="mt-1 mb-1" href="/tags#node">node (2)</a> <a class="mt-1 mb-1" href="/tags#python">python (1)</a> <a class="mt-1 mb-1" href="/tags#garbagecollection">garbagecollection (2)</a> <a class="mt-1 mb-1" href="/tags#nodejs">nodejs (2)</a> <a class="mt-1 mb-1" href="/tags#deno">deno (2)</a> <a class="mt-1 mb-1" href="/tags#v8">v8 (1)</a> <a class="mt-1 mb-1" href="/tags#memory-management">memory-management (1)</a> <a class="mt-1 mb-1" href="/tags#windows">windows (1)</a> <a class="mt-1 mb-1" href="/tags#vr">vr (1)</a> <a class="mt-1 mb-1" href="/tags#gaming">gaming (1)</a> <a class="mt-1 mb-1" href="/tags#polyglot">polyglot (1)</a> <a class="mt-1 mb-1" href="/tags#interview">interview (1)</a> <a class="mt-1 mb-1" href="/tags#womenintech">womenintech (1)</a> <a class="mt-1 mb-1" href="/tags#discuss">discuss (1)</a> <a class="mt-1 mb-1" href="/tags#pragmatic">pragmatic (1)</a> <a class="mt-1 mb-1" href="/tags#concurrency">concurrency (6)</a> <a class="mt-1 mb-1" href="/tags#async">async (3)</a> <a class="mt-1 mb-1" href="/tags#multithreading">multithreading (1)</a> <a class="mt-1 mb-1" href="/tags#golang">golang (1)</a> <a class="mt-1 mb-1" href="/tags#svelte">svelte (1)</a> <a class="mt-1 mb-1" href="/tags#web">web (1)</a> <a class="mt-1 mb-1" href="/tags#ubuntu">ubuntu (1)</a> <a class="mt-1 mb-1" href="/tags#kde">kde (1)</a> <a class="mt-1 mb-1" href="/tags#jvm">jvm (1)</a> <a class="mt-1 mb-1" href="/tags#webassembly">webassembly (1)</a></div></div></div><footer class="footer"><div class="container"><div class="row"><div class="col-md-6 col-sm-6 text-center text-lg-left">Copyright Â© 2021 Deepu K Sasidharan<br><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img class="lozad" alt="Creative Commons License" style="border-width:0" src="/assets/images/placeholder.jpg" data-src="https://i.creativecommons.org/l/by/4.0/88x31.png"> </a>Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net | Domain by <a href="https://js.org" target="_blank" title="JS.ORG | JavaScript Community"><img src="/assets/images/placeholder.jpg" data-src="https://logo.js.org/dark_tiny.png" style="width:50px" alt="JS.ORG Logo" class="lozad"> </a>| Hosted with <i class="far fa-heart"></i> by <a href="https://pages.github.com/" target="_blank">Github</a></div></div></div></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha256-WqU1JavFxSAMcLP2WIOI+GB2zWmShMI82mTpLDcqFUg=" crossorigin="anonymous"></script><script async src="/assets/js/mediumish.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js" integrity="sha256-hstwhDmGVwZjIwt6SlTG6sQBREWrWTBjVTik/JLlb1Y=" crossorigin="anonymous"></script><script>// lazy loads images
        const lazyloadObserver = lozad()
        lazyloadObserver.observe();</script><script async src="/assets/js/ie10-viewport-bug-workaround.js"></script><script async id="dsq-count-scr" src="//deepu-tech.disqus.com/count.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74370272-6"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-74370272-6');</script></body></html>