<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="icon" href="/assets/images/logo.png"><title>Deploying JHipster Microservices on Azure Kubernetes Service (AKS) | Technorage</title><meta name="generator" content="Jekyll v4.1.1"><meta property="og:title" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)"><meta name="author" content="deepu"><meta property="og:locale" content="en_US"><meta name="description" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)"><meta property="og:description" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)"><link rel="canonical" href="https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba"><meta property="og:url" content="https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba"><meta property="og:site_name" content="Technorage"><meta property="og:type" content="article"><meta property="article:published_time" content="2018-10-01T00:00:00+02:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)"><script type="application/ld+json">{"author":{"@type":"Person","name":"deepu"},"description":"Deploying JHipster Microservices on Azure Kubernetes Service (AKS)","headline":"Deploying JHipster Microservices on Azure Kubernetes Service (AKS)","dateModified":"2018-10-01T00:00:00+02:00","datePublished":"2018-10-01T00:00:00+02:00","@type":"BlogPosting","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://deepu.tech/assets/images/logo.png"},"name":"deepu"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba"},"url":"https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba","@context":"https://schema.org"}</script><link rel="canonical" href="https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba"><meta property="og:url" content=""><meta name="monetization" content="$ilp.uphold.com/Aw7eGpxKNyK7"><meta name="twitter:site" content="@deepu105"><meta name="twitter:creator" content="@deepu105"><meta name="twitter:title" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)"><meta name="twitter:description" content="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://thepracticaldev.s3.amazonaws.com/i/zvmxe2mqyft5qa6vajgd.png"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y=" crossorigin="anonymous"><link href="/assets/css/screen.css" rel="stylesheet"><link href="/assets/css/main.css" rel="stylesheet"></head><body class="layout-post"><noscript id="deferred-styles"><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css" crossorigin="anonymous"></noscript><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down pr-md-0 pl-md-0"><div class="container d-flex align-items-center"><a class="navbar-brand" href="/"><h2>Deepu K Sasidharan</h2></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarMediumish"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link" href="/">About</a></li><li class="nav-item active"><a class="nav-link" href="/blogs/"><i class="fas fa-blog"></i> Blog</a></li><li class="nav-item"><a class="nav-link" href="/books"><i class="fas fa-book"></i> Books</a></li><li class="nav-item"><a target="_blank" class="nav-link" href="https://www.youtube.com/playlist?list=PLxayiD7e52nPpb-sSaoOPc-zXGhmOaNHK"><i class="fab fa-youtube"></i> Videos</a></li><li class="nav-item"><a target="_blank" class="nav-link" href="https://speakerdeck.com/deepu105"><i class="fab fa-speaker-deck"></i> Presentations</a></li><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js" integrity="sha256-34Si1Y6llMBKM3G0jQILVeoQKEwuxjbk4zGWXXMT4ps=" crossorigin="anonymous"></script><style>.lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}</style><form class="bd-search" onsubmit="return lunr_search(document.getElementById('lunrsearch').value);"><input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."></form><div id="lunrsearchresults"><ul></ul></div><script src="/assets/js/lunrsearchengine.js"></script></ul></div></div></nav><div class="site-content"><div class="container"><div class="main-content"><div class="mainheading"><h1 class="sitetitle">Technorage</h1><p class="lead">Where I rage about technology and stuff!</p></div><div class="container"><div class="row"><div class="col-lg-2 pl-0"><div class="sticky-top sticky-top-offset"><div class="popover-wrapper d-none d-lg-block"><a href="#"><h2 class="popover-title"><i class="fas fa-stream fa-lg"></i> TOC</h2></a><div class="popover-content"><div class="toc lead"><h3 class="font-weight-bold">Summary</h3><ul><li><a href="#creating-the-microservice-application">Creating the microservice application</a></li><li><a href="#generating-the-kubernetes-configuration">Generating the Kubernetes configuration</a></li><li><a href="#preparing-aks-cluster">Preparing AKS Cluster</a></li><li><a href="#deploying-the-application-to-aks">Deploying the application to AKS</a></li><li><a href="#cleanup">Cleanup</a></li><li><a href="#conclusion">Conclusion</a></li></ul></div></div></div><div class="share"><p>Share</p><ul><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=Deploying JHipster Microservices on Azure Kubernetes Service (AKS) by @deepu105 &url=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=435');return false;" title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/&t=Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" onclick="window.open(this.href, 'hackernews-share', 'width=550,height=435');return false;" title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/&title=Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" onclick="window.open(this.href, 'reddit-share', 'width=550,height=435');return false;" title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;" title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul><div class="sep"></div><ul><li><a class="small smoothscroll" href="#disqus_thread"></a></li></ul></div><div class="ad-vertical-md"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3I&placement=deeputech" id="_carbonads_js"></script></div></div></div><div class="col-lg-9 flex-first flex-lg-unordered"><div class="mainheading"><h1 class="posttitle">Deploying JHipster Microservices on Azure Kubernetes Service (AKS)</h1><img data-src="https://thepracticaldev.s3.amazonaws.com/i/zvmxe2mqyft5qa6vajgd.png" alt="Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" class="featured-image img-fluid lozad" src="/assets/images/placeholder.jpg"><div class="row post-top-meta"><div class="col-12 text-center text-md-left mb-4 mb-md-0"><img class="author-thumb lozad" src="/assets/images/placeholder.jpg" data-src="https://www.gravatar.com/avatar/7f408bc67dc9ae3b288ee92d16d3c4c2?s=250&d=mm&r=x" alt="Deepu K Sasidharan"> <a target="_blank" class="link-dark" href="https://www.deepu.tech">Deepu K Sasidharan</a><a target="_blank" href="https://twitter.com/deepu105" class="btn follow">Follow</a><span class="separator d-none d-md-inline-block">| </span><span class="author-description"><small><time class="post-date" datetime="2018-10-01">01 Oct 2018</time> </small><span class="separator d-inline-block">| </span><small>12 mins read</small> <span class="separator d-inline-block d-lg-none">| </span><span class="d-inline-block d-lg-none"><div class="share" style="margin-top: 0;"><ul><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=Deploying JHipster Microservices on Azure Kubernetes Service (AKS) by @deepu105 &url=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'linkedin-share', 'width=550,height=435');return false;" title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/&t=Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" onclick="window.open(this.href, 'hackernews-share', 'width=550,height=435');return false;" title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/&title=Deploying JHipster Microservices on Azure Kubernetes Service (AKS)" onclick="window.open(this.href, 'reddit-share', 'width=550,height=435');return false;" title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;" title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul></div></span></span></div></div></div><div class="panel"><p><strong>This is part of my "Microservices with JHipster" series</strong></p><ol><li><a href="/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/">Create full Microservice stack using JHipster Domain Language under 30 minutes</a></li><li><strong>Deploying JHipster Microservices on Azure Kubernetes Service (AKS)</strong></li><li><a href="/jhipster-microservices-with-istio-service-mesh-on-kubernetes/">How to set up Java microservices with Istio service mesh on Kubernetes</a></li></ol></div><div class="article-post"><p>If you are developing and deploying applications to production, especially cloud, you would have heard about <a href="https://kubernetes.io/"><strong>Kubernetes</strong></a>. Kubernetes(<strong>k8s</strong>) is a container orchestration platform originally developed by Google and makes deploying containerized/dockerized applications to production more manageable and scalable.</p><p><a href="https://kubernetes.io/"><strong>Kubernetes</strong></a> has been crowned as the undeniable champion of container orchestration for a while now and every other <strong>K*S</strong> offering that we see sprouting up are testimonials for that. The <strong>K</strong> obviously stands for Kubernetes and <strong>S/E</strong> stands for Service/Engine and the first letter stands for the product offering it. So far we have <a href="https://docs.microsoft.com/en-us/azure/aks/"><strong>AKS</strong></a>(Azure), <a href="https://cloud.google.com/kubernetes-engine/"><strong>GKE</strong></a>(Google), and <a href="https://aws.amazon.com/eks/"><strong>EKS</strong></a>(Amazon ECS) and <a href="https://content.pivotal.io/pivotal-container-service-pks"><strong>PKS</strong></a>(Pivotal) and also some flavors from <a href="https://cloud.oracle.com/en_US/containers/kubernetes-engine#">Oracle</a> and RedHat(read <a href="https://www.redhat.com/en/technologies/cloud-computing/openshift">Openshift</a>)</p><p>One of my colleagues have written a <a href="https://blog.xebialabs.com/2017/12/12/future-container-solutions-will-k-shaped/">nice article</a> about it, I highly recommend you read it as well.</p><p>In this article, we will see how we can deploy a microservice architecture created by JHipster to Azure Kubernetes Service.</p><p>Azure Kubernetes Service(AKS) is the managed Kubernetes platform offering from Microsoft to host your containerized applications.</p><h3 id="creating-the-microservice-application">Creating the microservice application</h3><p>In one of my <a href="https://deepu.tech/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/">previous posts</a>, I showcased how to create a full stack microservice architecture using <strong>JHipster</strong> and <strong>JDL</strong>, read the post <a href="https://deepu.tech/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/">here</a> if you want to learn more details about it. For this exercise, we will use the same application.</p><p>Let us recap the steps required.</p><p>Create a JDL file, let’s say app.jdl, and copy the below content into it.</p><noscript><pre>400: Invalid request</pre></noscript><script src="https://gist.github.com/127b220d0c7a3bbf06386cef8128d2f5.js"></script><p>Now create a directory called <strong>ecommerce</strong> and navigate into it. Run the JHipster import-jdl command. It could take a few minutes, especially the NPM install step.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ mkdir ecommerce &amp;&amp; cd ecommerce
$ jhipster import-jdl app.jdl
</pre></td></tr></tbody></table></code></pre></div></div><p>Once the JHipster process is complete, you will see that we have our store gateway, invoice service and notification service created and ready for us. The process until this is explained in more detail in my previous post <a href="https://deepu.tech/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/">here</a> and you can deploy the application locally using Docker as explained in that post. If you haven’t done that before I strongly suggest that step so that you get an idea of the application and you also can make sure it works locally on your machine.</p><h3 id="generating-the-kubernetes-configuration">Generating the Kubernetes configuration</h3><p>Now that our application is ready, let us create the required configurations for Kubernetes using JHipster. This can also be done using JDL by adding below snippet to the JDL file we used earlier.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>deployment {
  deploymentType kubernetes
  appsFolders [store, invoice, notification]
  serviceDiscoveryType eureka
  dockerRepositoryName "deepu105" // use your own docker repo username here
  kubernetesNamespace jhipster
  kubernetesServiceType LoadBalancer
  monitoring no
}
</pre></td></tr></tbody></table></code></pre></div></div><p>For now, let us use the JHipster CLI to do this. In the ecommerce folder, we created earlier, create a new directory, let’s call in k8s so that we get the below structure.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>├── app.jdl
├── invoice
├── kubernetes
├── notification
└── store
</pre></td></tr></tbody></table></code></pre></div></div><p>Create the kubernetes directory and navigate to it. Now run the JHipster Kubernetes command there.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>$ mkdir kubernetes &amp;&amp; cd kubernetes
$ jhipster kubernetes
</pre></td></tr></tbody></table></code></pre></div></div><p>The generator will ask you a few questions and choose the answers as highlighted below, as you can see the questions are very similar to the ones asked by jhipster docker-compose command. For the “base Docker repository name” provide your own docker hub account id(For example, my Docker Hub id is <a href="https://hub.docker.com/u/deepu105/">deepu105</a>). For real-world use cases, you could also use a private image repository like the <a href="https://docs.microsoft.com/en-us/azure/aks/tutorial-kubernetes-prepare-acr">Azure Container Registry</a> and in that case, you would have to provide the ACR login server name here. For now, let us keep it simple.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>⎈ Welcome to the JHipster Kubernetes Generator ⎈
Files will be generated in folder: /home/deepu/workspace/temp/ecommerce/kubernetes
✔ Docker is installed

? Which *type* of application would you like to deploy? Microservice application

? Enter the root directory where your gateway(s) and microservices are located ../

3 applications found at /home/deepu/workspace/temp/ecommerce/
? Which applications do you want to include in your configuration? invoice, notification, store

? Do you want to setup monitoring for your applications ? No

? Which applications do you want to use with clustered databases (only available with MongoDB and Couchbase)? 

JHipster registry detected as the service discovery and configuration provider used by your apps

? Enter the admin password used to secure the JHipster Registry admin

? What should we use for the Kubernetes namespace? jhipster

? What should we use for the base Docker repository name? &lt;your Docker hub account id&gt;

? What command should we use for push Docker image to repository? docker push

? Do you want to enable Istio? No

? Choose the kubernetes service type for your edge services LoadBalancer - Let a kubernetes cloud provider automatically assign an IP
</pre></td></tr></tbody></table></code></pre></div></div><p>The generator will go to work with this and will create the following files and output.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre>   create invoice/invoice-deployment.yml
   create invoice/invoice-service.yml
   create invoice/invoice-mysql.yml
   create notification/notification-deployment.yml
   create notification/notification-service.yml
   create notification/notification-mongodb.yml
   create store/store-deployment.yml
   create store/store-service.yml
   create store/store-mysql.yml
   create README.md
   create registry/jhipster-registry.yml
   create registry/application-configmap.yml
   create kubectl-apply.sh

WARNING! Kubernetes configuration generated with missing images!

To generate the missing Docker image(s), please run:

  ./gradlew -Pprod bootWar jibDockerBuild in /home/deepu/workspace/temp/ecommerce/invoice

  ./gradlew -Pprod bootWar jibDockerBuild in /home/deepu/workspace/temp/ecommerce/notification

  ./gradlew -Pprod bootWar jibDockerBuild in /home/deepu/workspace/temp/ecommerce/store

WARNING! You will need to push your image to a registry. If you have not done so, use the following commands to tag and push the images:

  docker image tag invoice deepu105/invoice
  docker push deepu105/invoice

  docker image tag notification deepu105/notification
  docker push deepu105/notification

  docker image tag store deepu105/store
  docker push deepu105/store

You can deploy all your apps by running the following script:
  ./kubectl-apply.sh

Use these commands to find your application's IP addresses:
  kubectl get svc store

Congratulations, JHipster execution is complete!
</pre></td></tr></tbody></table></code></pre></div></div><p>As you can see the generator creates all the required Kubernetes configuration files and prints out useful information to proceed further (Note that the docker hub id you provided will be in the instructions in place of <strong>deepu105</strong> here). Go through the generated k8s files and familiarize yourself.</p><p>Now we are ready.</p><p>Let us build and push the docker images for our application. Follow the instructions above and build docker images in each of the application folders and then tag and push the images to your Docker hub account.</p><h3 id="preparing-aks-cluster">Preparing AKS Cluster</h3><p>Now that our applications are built and pushed its time for us to deploy them to AKS. But before that let’s make sure we have all the prerequisites ready. You will need the below tools.</p><ol><li><p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a>: The command line tool to interact with Kubernetes. Install and configure it.</p></li><li><p><a href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest">Azure CLI</a>: The command line tool to interact with Azure. Install and log in with your Azure account(You can create a <a href="https://azure.microsoft.com/en-us/free/">free account</a> if you don’t have one already).</p></li></ol><p>Once the tools are ready let us prepare our Kubernetes cluster.</p><p>First, let us create a resource group. Run the below command. This will create a resource group named <strong>eCommerceCluster</strong> in US east location(You can use other <a href="https://azure.microsoft.com/en-us/global-infrastructure/regions/">Azure regions</a> as well).</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ az group create --name eCommerceCluster --location eastus
</pre></td></tr></tbody></table></code></pre></div></div><p>Now let us create an AKS cluster on the resource group we just created. Run the below command to create a cluster named eCommerceCluster with two nodes(We would need some room to run all those containers). It also enables the Azure monitor on the cluster through the add-on specified.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>$ az aks create --resource-group eCommerceCluster \
--name eCommerceCluster --node-count 2 \
--enable-addons monitoring --generate-ssh-keys
</pre></td></tr></tbody></table></code></pre></div></div><p>This would take several minutes to complete hence be patient and have a coffee :)</p><p>Did I emphasize on <strong>several minutes</strong>?</p><p>Once it’s done you should see the cluster information printed out as JSON.</p><p>Now, let us configure <strong>kubectl</strong> to connect to the AKS cluster we just created. This can be done automatically using the Azure CLI by running the below handy command.</p><p>Note: Some Azure CLI commands might take a while to execute, especially if you are on a slow network, sometimes if the below commands seem stalled or if it is timed out, kill it and retry again.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ az aks get-credentials --resource-group eCommerceCluster --name eCommerceCluster
</pre></td></tr></tbody></table></code></pre></div></div><p>Verify that we are able to connect to the cluster by running kubectl get nodes</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ kubectl get nodes
NAME                       STATUS    ROLES     AGE       VERSION
aks-nodepool1-34429729-0   Ready     agent     22m       v1.9.9
aks-nodepool1-34429729-1   Ready     agent     22m       v1.9.9
</pre></td></tr></tbody></table></code></pre></div></div><h3 id="deploying-the-application-to-aks">Deploying the application to AKS</h3><p>Now that our cluster is ready, let us deploy our microservice stack to this cluster.</p><p>We can deploy our application using the kubectl apply command for this we have to navigate to the k8s folder we created earlier and run the below commands in the same order</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>$ kubectl apply -f registry

$ kubectl apply -f invoice

$ kubectl apply -f notification

$ kubectl apply -f store
</pre></td></tr></tbody></table></code></pre></div></div><p>Or you could also just run the handy <code class="language-plaintext highlighter-rouge">kubectl-apply.sh</code> script generated which runs the above.</p><p>So we are deploying the JHipster Registry first as it is required for other services, followed by the microservices and finally our gateway(store).</p><p>If you get a timeout during any of these, as I did, just try the command again.</p><p>Though the services get created fast, the actual applications might not be up and running yet, give the entire thing a minute or two to start.</p><p>Now run kubectl get pods to see the status of our containers.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>$ kubectl get pods -w

NAME                                    READY  STATUS 
invoice-5ffb46d944-h8x42                1/1    Running
invoice-mysql-66bc4b7874-p7ghk          1/1    Running
jhipster-registry-0                     1/1    Running
jhipster-registry-1                     1/1    Running
notification-76847b7667-d7xjb           1/1    Running
notification-mongodb-6db986b556-8bw8z   1/1    Running
store-8dc5cd6f7-s2dpx                   1/1    Running
store-mysql-779d66685d-tmkqd            1/1    Running
</pre></td></tr></tbody></table></code></pre></div></div><p>Note: I have removed some info for brevity in the above output.</p><p>Wait until all the containers are in <strong>Running</strong> status. Once the containers are running we can run the kubectl get service command to get the external IP for the application.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ kubectl get service store

NAME   TYPE         CLUSTER-IP    EXTERNAL-IP    PORT(S)         AGE
store  LoadBalancer 10.0.189.145  40.117.140.228 8080:30143/TCP  18m
</pre></td></tr></tbody></table></code></pre></div></div><p>In this case, the external IP for our gateway application is <strong>40.117.140.228</strong> running on port <strong>8080</strong>. Let us open it up in a web browser.</p><p><img src="https://cdn-images-1.medium.com/max/2624/1*OQSuDw4u-CHGdkl0VR_DIw.png" alt="The Gateway application login page"><em>The Gateway application login page</em></p><p>The JHipster registry is deployed as a headless service by default. If we need to access the registry we need to create a secondary service with a Load Balancer. Run the below command to expose the second service.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ kubectl expose service jhipster-registry --type=LoadBalancer --name=exposed-registry
</pre></td></tr></tbody></table></code></pre></div></div><p>Now run the kubectl get service command to get the IP.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>$ kubectl get service exposed-registry

NAME             TYPE         CLUSTER-IP   EXTERNAL-IP    PORT(S)
exposed-registry LoadBalancer 10.0.107.121 104.211.15.142 8761:32628/TCP
</pre></td></tr></tbody></table></code></pre></div></div><p>Visit the URL in a browser to see the registry in action</p><p><img src="https://cdn-images-1.medium.com/max/2978/1*tWbLvvpXCF9kHPmEadyMKQ.png" alt="JHipster Registry home page"><em>JHipster Registry home page</em></p><p>We can now scale any of our services by simply running kubectl scale command. For example, let us scale our Invoice service.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ kubectl scale --replicas=2 deployment/invoice
</pre></td></tr></tbody></table></code></pre></div></div><p>Now we can visit the <strong>Eureka -&gt; Instances</strong> on our Registry and see that the Invoice service has two instances.</p><p><img src="https://cdn-images-1.medium.com/max/2596/1*YGhPu44fNsApmKZYXQAaqQ.png" alt="JHipster Registry instances page"><em>JHipster Registry instances page</em></p><p>Running kubectl get pods will also show you the new instance.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>$ kubectl get pods
 
NAME                                  READY  STATUS   AGE
invoice-5ffb46d944-g8j6j              1/1    Running  4m
invoice-5ffb46d944-h8x42              1/1    Running  2h
invoice-mysql-66bc4b7874-p7ghk        1/1    Running  2h
jhipster-registry-0                   1/1    Running  2h
jhipster-registry-1                   1/1    Running  2h
notification-76847b7667-d7xjb         1/1    Running  2h
notification-mongodb-6db986b556-8bw8z 1/1    Running  2h
store-8dc5cd6f7-s2dpx                 1/1    Running  2h
store-mysql-779d66685d-tmkqd          1/1    Running  2h
</pre></td></tr></tbody></table></code></pre></div></div><p>That is it, we have successfully got our application deployed to AKS and scaled our service on demand.</p><h3 id="cleanup">Cleanup</h3><p>Once you are done its always a good idea to clean up especially since we don’t want to keep unnecessary resources that might eat up our free credits on Azure.</p><p>Let us delete the cluster from AKS and related resources created by deleting the entire resource group.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>$ az group delete --name eCommerceCluster --yes --no-wait
</pre></td></tr></tbody></table></code></pre></div></div><p>Cluster related activities like creation/update/deletion could take several minutes on AKS so we have to be patient again here.</p><h3 id="conclusion">Conclusion</h3><p>Kubernetes is definitely the best way to deploy microservice applications to production but creating and managing Kubernetes clusters itself is not an easy task, but Kubernetes services like <strong>GKE</strong> and <strong>AKS</strong> makes it a cakewalk. In my personal experience, the Kubernetes service from Google(GKE) and Azure(AKS) are by far the best in terms of ease of use and available tooling. These services provide very handy command line tools which work nicely together with <strong>kubectl</strong> to provide a very nice experience. They also have nice UI portals if you are not a fan of the CLI.</p><p>JHipster provides a great Kubernetes setup to start with which you can further tweak as per your needs and platform.</p><p>In upcoming posts, we will look at more services like GKE(Google), EKS(Amazon) and Openshift(RedHat)</p><p>To learn more about JHipster, check out my book “<em>Full Stack Development with JHipster</em>” on <a href="https://www.amazon.com/Stack-Development-JHipster-Deepu-Sasidharan/dp/178847631X">Amazon</a> and <a href="https://www.packtpub.com/application-development/full-stack-development-jhipster">Packt</a>.</p><p>If you like JHipster don’t forget to give it a star on <a href="https://github.com/jhipster/generator-jhipster">Github</a>.</p><p>If you like this article, please leave a like or a comment.</p><p>You can follow me on <a href="https://twitter.com/deepu105">Twitter</a> and <a href="https://www.linkedin.com/in/deepu05/">LinkedIn</a>.</p><p>My other related posts:</p><ol><li><p><a href="https://deepu.tech/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/">Create full Microservice stack using JHipster Domain Language under 30 minutes</a></p></li><li><p><a href="https://deepu.tech/jhipster-microservices-with-istio-service-mesh-on-kubernetes/">JHipster microservices with Istio service mesh on Kubernetes</a></p></li></ol><p>Originally published in <a href="https://medium.com/jhipster/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-fb46991746ba">Medium</a> on Oct 01, 2018</p><p><em>Also published at <a href="https://dev.to/deepu105/deploying-jhipster-microservices-on-azure-kubernetes-service-aks-2g6d">Dev.to</a></em></p></div><hr><p>Post <strong>2</strong> of <strong>3</strong> in series <strong>"Microservices with JHipster"</strong>.</p><p></p><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" rel="prev" href="/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/">&laquo; Prev post in series</a> <a class="prev d-block col-md-6 text-right" rel="next" href="/jhipster-microservices-with-istio-service-mesh-on-kubernetes/">Next post in series &raquo;</a><div class="clearfix"></div></div><div class="after-post-cats"><ul class="tags mb-4"></ul></div><div class="after-post-tags"><ul class="tags"><li><a class="smoothscroll" href="/tags#azure">#azure</a></li><li><a class="smoothscroll" href="/tags#jhipster">#jhipster</a></li><li><a class="smoothscroll" href="/tags#kubernetes">#kubernetes</a></li><li><a class="smoothscroll" href="/tags#microservices">#microservices</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" href="/create-full-microservice-stack-using-j-hipster-domain-language-under-30-minutes/">&laquo; Create full Microservice stack using JHipster Domain Language under 30 minutes</a> <a class="next d-block col-md-6 text-lg-right" href="/react-done-right-with-typescript/">React components done right with TypeScript mapped and conditional types &raquo;</a><div class="clearfix"></div></div><hr></div></div></div><div class="container"><div id="comments" class="row justify-content-center mb-5"><div class="col-md-8"><section class="comments"><h2 class="page__section-label">Leave a Comment <small><a rel="nofollow" id="cancel-comment-reply-link" href="https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/#respond" style="display: none">Cancel reply</a></small></h2><form id="comment-form" method="post" action="https://staticman-deepu.herokuapp.com/v3/entry/github/deeputech/deeputech.github.io/site_src/comments" class="wj-contact-form"><fieldset class="mc-field-group"><label for="comment-form-message">Comment <small>(<a href="https://kramdown.gettalong.org/quickref.html">Markdown</a> is allowed)</small></label> <textarea type="text" rows="6" id="comment-form-message" name="fields[message]" tabindex="1" required spellcheck="true"></textarea></fieldset><fieldset><label for="comment-form-name">Name</label> <input type="text" id="comment-form-name" name="fields[name]" tabindex="2" required spellcheck="false"></fieldset><fieldset><label for="comment-form-email">Email address <small>(Optional, used for <a href="http://gravatar.com">Gravatar</a> image and reply notifications)</small></label> <input type="email" id="comment-form-email" name="fields[email]" tabindex="3" spellcheck="false"></fieldset><fieldset><label for="comment-form-url">Website <small>(Optional)</small></label> <input type="url" id="comment-form-url" name="fields[url]" tabindex="4"></fieldset><fieldset class="hidden" style="display: none"><input type="hidden" name="options[origin]" value="https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/"> <input type="hidden" name="options[parent]" value="https://deepu.tech/deploying-jhipster-microservices-on-azure-kubernetes-service-aks/"> <input type="hidden" id="comment-replying-to" name="fields[replying_to]" value=""> <input type="hidden" id="comment-post-id" name="options[slug]" value="deploying-jhipster-microservices-on-azure-kubernetes-service-aks"> <input type="hidden" id="comment-parent" name="fields[replying_to]" value=""> <label for="comment-form-location">Not used. Leave blank if you are a human.</label> <input type="text" id="comment-form-location" name="fields[hidden]" autocomplete="off"></fieldset><fieldset><label for="comment-form-reply"><input type="checkbox" id="comment-form-reply" name="options[subscribe]" value="email"> Notify me of replies by email.</label> <button type="submit" id="comment-form-submit" class="btn-submit" tabindex="5">Submit Comment</button></fieldset></form>Comments powered by <a href="https://staticman.net/" class="dsq-brlink">Staticman</a></section></div></div></div></div><div class="alertbar"><div class="container text-center"><span>Never miss a <b>story</b> from us, subscribe to our newsletter</span><form action="https://tech.us7.list-manage.com/subscribe/post?u=00729f6c6d6bb180801b9484e&amp;id=f521dede4b" method="post" name="mc-embedded-subscribe-form" id="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate><div class="mc-field-group"><input type="email" placeholder="Email address" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required> <input type="submit" value="Subscribe" name="subscribe" class="heart"></div></form></div></div></div><div class="jumbotron fortags lozad" data-background-image="/assets/images/jumbotron.jpg"><div class="d-md-flex h-100"><div class="col-md-4 transpdark align-self-center text-center h-100"><div class="d-md-flex align-items-center justify-content-center h-100"><h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2></div></div><div class="col-md-8 p-5 align-self-center text-center"><a class="mt-1 mb-1" href="/tags#jhipster">jhipster (3)</a> <a class="mt-1 mb-1" href="/tags#java">java (7)</a> <a class="mt-1 mb-1" href="/tags#microservices">microservices (5)</a> <a class="mt-1 mb-1" href="/tags#docker">docker (2)</a> <a class="mt-1 mb-1" href="/tags#azure">azure (2)</a> <a class="mt-1 mb-1" href="/tags#kubernetes">kubernetes (3)</a> <a class="mt-1 mb-1" href="/tags#typescript">typescript (5)</a> <a class="mt-1 mb-1" href="/tags#react">react (2)</a> <a class="mt-1 mb-1" href="/tags#javascript">javascript (12)</a> <a class="mt-1 mb-1" href="/tags#webdev">webdev (2)</a> <a class="mt-1 mb-1" href="/tags#terraform">terraform (1)</a> <a class="mt-1 mb-1" href="/tags#writing">writing (1)</a> <a class="mt-1 mb-1" href="/tags#medium">medium (1)</a> <a class="mt-1 mb-1" href="/tags#development">development (3)</a> <a class="mt-1 mb-1" href="/tags#tech">tech (1)</a> <a class="mt-1 mb-1" href="/tags#linux">linux (4)</a> <a class="mt-1 mb-1" href="/tags#fedora">fedora (3)</a> <a class="mt-1 mb-1" href="/tags#gnome">gnome (2)</a> <a class="mt-1 mb-1" href="/tags#desktop">desktop (1)</a> <a class="mt-1 mb-1" href="/tags#terminal">terminal (1)</a> <a class="mt-1 mb-1" href="/tags#ohmyzsh">ohmyzsh (1)</a> <a class="mt-1 mb-1" href="/tags#zsh">zsh (1)</a> <a class="mt-1 mb-1" href="/tags#go">go (5)</a> <a class="mt-1 mb-1" href="/tags#programming">programming (14)</a> <a class="mt-1 mb-1" href="/tags#languages">languages (14)</a> <a class="mt-1 mb-1" href="/tags#thepragmaticprogrammer">thepragmaticprogrammer (3)</a> <a class="mt-1 mb-1" href="/tags#vscode">vscode (1)</a> <a class="mt-1 mb-1" href="/tags#ide">ide (1)</a> <a class="mt-1 mb-1" href="/tags#opensource">opensource (1)</a> <a class="mt-1 mb-1" href="/tags#istio">istio (1)</a> <a class="mt-1 mb-1" href="/tags#functional">functional (4)</a> <a class="mt-1 mb-1" href="/tags#beginners">beginners (8)</a> <a class="mt-1 mb-1" href="/tags#showdev">showdev (2)</a> <a class="mt-1 mb-1" href="/tags#ruby">ruby (1)</a> <a class="mt-1 mb-1" href="/tags#Jekyll">Jekyll (1)</a> <a class="mt-1 mb-1" href="/tags#blogging">blogging (1)</a> <a class="mt-1 mb-1" href="/tags#architecture">architecture (1)</a> <a class="mt-1 mb-1" href="/tags#devops">devops (1)</a> <a class="mt-1 mb-1" href="/tags#distributedsystems">distributedsystems (1)</a> <a class="mt-1 mb-1" href="/tags#rust">rust (6)</a> <a class="mt-1 mb-1" href="/tags#bash">bash (1)</a> <a class="mt-1 mb-1" href="/tags#codenewbie">codenewbie (1)</a> <a class="mt-1 mb-1" href="/tags#codequality">codequality (2)</a> <a class="mt-1 mb-1" href="/tags#career">career (2)</a> <a class="mt-1 mb-1" href="/tags#computerscience">computerscience (4)</a> <a class="mt-1 mb-1" href="/tags#motivation">motivation (1)</a> <a class="mt-1 mb-1" href="/tags#books">books (1)</a> <a class="mt-1 mb-1" href="/tags#kotlin">kotlin (1)</a> <a class="mt-1 mb-1" href="/tags#scala">scala (1)</a> <a class="mt-1 mb-1" href="/tags#clojure">clojure (1)</a> <a class="mt-1 mb-1" href="/tags#WebAssembly">WebAssembly (1)</a> <a class="mt-1 mb-1" href="/tags#node">node (2)</a> <a class="mt-1 mb-1" href="/tags#python">python (1)</a> <a class="mt-1 mb-1" href="/tags#garbagecollection">garbagecollection (2)</a> <a class="mt-1 mb-1" href="/tags#nodejs">nodejs (2)</a> <a class="mt-1 mb-1" href="/tags#deno">deno (2)</a> <a class="mt-1 mb-1" href="/tags#v8">v8 (1)</a> <a class="mt-1 mb-1" href="/tags#memory-management">memory-management (1)</a> <a class="mt-1 mb-1" href="/tags#windows">windows (1)</a> <a class="mt-1 mb-1" href="/tags#vr">vr (1)</a> <a class="mt-1 mb-1" href="/tags#gaming">gaming (1)</a> <a class="mt-1 mb-1" href="/tags#polyglot">polyglot (1)</a> <a class="mt-1 mb-1" href="/tags#interview">interview (1)</a> <a class="mt-1 mb-1" href="/tags#womenintech">womenintech (1)</a> <a class="mt-1 mb-1" href="/tags#discuss">discuss (1)</a> <a class="mt-1 mb-1" href="/tags#pragmatic">pragmatic (1)</a> <a class="mt-1 mb-1" href="/tags#concurrency">concurrency (6)</a> <a class="mt-1 mb-1" href="/tags#async">async (3)</a> <a class="mt-1 mb-1" href="/tags#multithreading">multithreading (1)</a> <a class="mt-1 mb-1" href="/tags#golang">golang (1)</a> <a class="mt-1 mb-1" href="/tags#svelte">svelte (1)</a> <a class="mt-1 mb-1" href="/tags#web">web (1)</a> <a class="mt-1 mb-1" href="/tags#ubuntu">ubuntu (1)</a> <a class="mt-1 mb-1" href="/tags#kde">kde (1)</a> <a class="mt-1 mb-1" href="/tags#jvm">jvm (1)</a> <a class="mt-1 mb-1" href="/tags#webassembly">webassembly (1)</a></div></div></div><footer class="footer"><div class="container"><div class="row"><div class="col-md-6 col-sm-6 text-center text-lg-left">Copyright © 2021 Deepu K Sasidharan<br><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img class="lozad" alt="Creative Commons License" style="border-width:0" src="/assets/images/placeholder.jpg" data-src="https://i.creativecommons.org/l/by/4.0/88x31.png"> </a>Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net | Domain by <a href="https://js.org" target="_blank" title="JS.ORG | JavaScript Community"><img src="/assets/images/placeholder.jpg" data-src="https://logo.js.org/dark_tiny.png" style="width:50px" alt="JS.ORG Logo" class="lozad"> </a>| Hosted with <i class="far fa-heart"></i> by <a href="https://pages.github.com/" target="_blank">Github</a></div></div></div></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha256-WqU1JavFxSAMcLP2WIOI+GB2zWmShMI82mTpLDcqFUg=" crossorigin="anonymous"></script><script async src="/assets/js/mediumish.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js" integrity="sha256-hstwhDmGVwZjIwt6SlTG6sQBREWrWTBjVTik/JLlb1Y=" crossorigin="anonymous"></script><script>// lazy loads images
        const lazyloadObserver = lozad()
        lazyloadObserver.observe();</script><script async src="/assets/js/ie10-viewport-bug-workaround.js"></script><script async id="dsq-count-scr" src="//deepu-tech.disqus.com/count.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74370272-6"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-74370272-6');</script></body></html>