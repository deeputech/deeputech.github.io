<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="icon" href="/assets/images/logo.png"><title>The state of pattern matching in Java 17 | Technorage</title><meta name="generator" content="Jekyll v4.1.1"><meta property="og:title" content="The state of pattern matching in Java 17"><meta name="author" content="deepu"><meta property="og:locale" content="en_US"><meta name="description" content="Let us see how pattern matching is evolving in Java"><meta property="og:description" content="Let us see how pattern matching is evolving in Java"><link rel="canonical" href="https://deepu.tech/state-of-pattern-matching-java/"><meta property="og:url" content="https://deepu.tech/state-of-pattern-matching-java/"><meta property="og:site_name" content="Technorage"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-12-23T00:00:00+01:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="The state of pattern matching in Java 17"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"deepu"},"dateModified":"2021-12-23T00:00:00+01:00","datePublished":"2021-12-23T00:00:00+01:00","description":"Let us see how pattern matching is evolving in Java","headline":"The state of pattern matching in Java 17","mainEntityOfPage":{"@type":"WebPage","@id":"https://deepu.tech/state-of-pattern-matching-java/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://deepu.tech/assets/images/logo.png"},"name":"deepu"},"url":"https://deepu.tech/state-of-pattern-matching-java/"}</script><link rel="canonical" href="https://deepu.tech/state-of-pattern-matching-java/"><meta property="og:url" content=""><meta name="monetization" content="$ilp.uphold.com/Aw7eGpxKNyK7"><meta name="twitter:site" content="@deepu105"><meta name="twitter:creator" content="@deepu105"><meta name="twitter:title" content="The state of pattern matching in Java 17"><meta name="twitter:description" content="Let us see how pattern matching is evolving in Java"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://i.imgur.com/DK0pANn.jpeg"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y=" crossorigin="anonymous" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y=" crossorigin="anonymous"></noscript><link href="/assets/css/main.css" rel="stylesheet"></head><body class="layout-post"><noscript id="deferred-styles"><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:400" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.7.1/css/all.css" crossorigin="anonymous"></noscript><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down pr-md-0 pl-md-0"><div class="container d-flex align-items-center"><a class="navbar-brand" href="/"><h2 class="sitetitle">Technorage</h2><small class="sitetitlesub">Where I rant about technology and stuff! </small></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarMediumish"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link" href="/">About</a></li><li class="nav-item active"><a class="nav-link" href="/blogs/"><i class="fas fa-blog"></i> Blog</a></li><li class="nav-item"><a class="nav-link" href="/books"><i class="fas fa-book"></i> Books</a></li><li class="nav-item"><a class="nav-link" href="/appearances"><i class="fas fa-chalkboard-teacher"></i> Events</a></li><style>.lunrsearchresult .title{color:#d9230f}.lunrsearchresult .url{color:silver}.lunrsearchresult a{display:block;color:#777}.lunrsearchresult a:focus,.lunrsearchresult a:hover{text-decoration:none}.lunrsearchresult a:hover .title{text-decoration:underline}</style><form class="bd-search" onsubmit='return lunr_search(document.getElementById("lunrsearch").value)'><input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."></form><div id="lunrsearchresults"><ul></ul></div></ul></div></div></nav><div class="site-content"><div class="container"><div class="main-content"><div class="container mt-5"><div class="row"><div class="col-lg-2 pl-0"><div class="sticky-top sticky-top-offset"><div class="popover-wrapper d-none d-lg-block"><a href="#"><h2 class="popover-title"><i class="fas fa-stream fa-lg"></i> TOC</h2></a><div class="popover-content"><div class="toc lead"><h3 class="font-weight-bold">Summary</h3><ul><li><a href="#why-pattern-matching">Why Pattern matching?</a></li><li><a href="#pattern-matching-features">Pattern matching features</a></li><li><a href="#pattern-matching-in-java">Pattern matching in Java</a><ul><li><a href="#pattern-matching-for-instanceof">Pattern matching for <code class="language-plaintext highlighter-rouge">instanceof</code></a></li><li><a href="#pattern-matching-for-switch">Pattern matching for switch</a></li><li><a href="#type-guards--pattern-refinement">Type Guards &amp; pattern refinement</a></li><li><a href="#pattern-exhaustion-with-sealed-classes">Pattern exhaustion with Sealed classes</a></li><li><a href="#partial-patterns-and-destructing">Partial patterns and destructing</a></li></ul></li></ul></div></div></div><div class="share"><p>Share</p><ul><li class="ml-1 mr-1"><div class="mast-share mast-share-sm"><input type="checkbox" class="mast-check-toggle"><div class="mast-instance"><span>Instance: </span><input type="textbox" name="mast-instance-input" placeholder="mastodon.social"> <button class="mast-share-button">Share</button></div><label title="Mastodon" class="mast-top mast-check-label"><i class="fab fa-mastodon"></i></label></div><script>Array.prototype.forEach || (Array.prototype.forEach = function (r) { var o, t; if (null == this) throw new TypeError("this is null or not defined"); var n = Object(this), e = n.length >>> 0; if ("function" != typeof r) throw new TypeError(r + " is not a function"); for (arguments.length > 1 && (o = arguments[1]), t = 0; t < e;) { var i; t in n && (i = n[t], r.call(o, i, t, n)), t++ } }); document.addEventListener("DOMContentLoaded", function () { document.querySelectorAll(".mast-share").forEach(function (e, t) { e.querySelector(".mast-check-toggle").id = "mast-check-toggle-" + t, e.querySelector(".mast-check-label").htmlFor = "mast-check-toggle-" + t, e.querySelector(".mast-share-button").addEventListener("click", function (t) { var a = new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@|\\d{1,3}(?:\\.\\d{1,3}){3}|(?:(?:[a-z\\d\\u00a1-\\uffff]+-?)*[a-z\\d\\u00a1-\\uffff]+)(?:\\.(?:[a-z\\d\\u00a1-\\uffff]+-?)*[a-z\\d\\u00a1-\\uffff]+)*(?:\\.[a-z\\u00a1-\\uffff]{2,6}))(?::\\d+)?(?:[^\\s]*)?$", "i"), n = e.querySelector('input[name="mast-instance-input"]'); if (a.test(n.value)) { var o = `http://${n.value.replace(/(^\w+:|^)\/\//, "")}/share?text=${encodeURIComponent(document.title)} ${encodeURIComponent(location.href)}`; window.open(o, "new", "toolbar=no,location=no,status=yes,resizable=yes,scrollbars=yes,height=600,width=400") } else n.classList.add("invalid"), setTimeout(function () { n.classList.remove("invalid") }, 300) }), e.addEventListener("mouseleave", function (t) { e.querySelector(".mast-check-toggle").checked = !1 }) }) });</script></li><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=The state of pattern matching in Java 17 by @deepu105 &url=https://deepu.tech/state-of-pattern-matching-java/" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1' title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/state-of-pattern-matching-java/" onclick='return window.open(this.href,"linkedin-share","width=550,height=435"),!1' title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/state-of-pattern-matching-java/&t=The state of pattern matching in Java 17" onclick='return window.open(this.href,"hackernews-share","width=550,height=435"),!1' title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/state-of-pattern-matching-java/&title=The state of pattern matching in Java 17" onclick='return window.open(this.href,"reddit-share","width=550,height=435"),!1' title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/state-of-pattern-matching-java/" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1' title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul></div><div class="ad-vertical-md"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3I&placement=deeputech" id="_carbonads_js"></script></div></div></div><div class="col-lg-9 flex-first flex-lg-unordered"><div class="mainheading"><h1 class="posttitle">The state of pattern matching in Java 17</h1><img data-src="https://i.imgur.com/DK0pANn.jpeg" alt="The state of pattern matching in Java 17" class="featured-image img-fluid lozad" src="/assets/images/placeholder.jpg"><div class="row post-top-meta"><div class="col-12 text-center text-md-left mb-4 mb-md-0"><img class="author-thumb lozad" src="/assets/images/placeholder.jpg" data-src="https://www.gravatar.com/avatar/7f408bc67dc9ae3b288ee92d16d3c4c2?s=250&d=mm&r=x" alt="Deepu K Sasidharan"> <a target="_blank" class="link-dark" href="https://www.deepu.tech">Deepu K Sasidharan</a><a target="_blank" href="https://mastodon.social/@deepu105" class="btn follow"><i class="fab fa-mastodon"></i> Follow</a><span class="separator d-none d-md-inline-block">| </span><span class="author-description"><small><time class="post-date" datetime="2021-12-23">23 Dec 2021</time> </small><span class="separator d-inline-block">| </span><small>12 mins read </small><span class="separator d-inline-block d-lg-none">| </span><span class="d-inline-block d-lg-none"><div class="share" style="margin-top:0"><ul><li class="ml-1 mr-1"><div class="mast-share mast-share-sm"><input type="checkbox" class="mast-check-toggle"><div class="mast-instance"><span>Instance: </span><input type="textbox" name="mast-instance-input" placeholder="mastodon.social"> <button class="mast-share-button">Share</button></div><label title="Mastodon" class="mast-top mast-check-label"><i class="fab fa-mastodon"></i></label></div><script>Array.prototype.forEach || (Array.prototype.forEach = function (r) { var o, t; if (null == this) throw new TypeError("this is null or not defined"); var n = Object(this), e = n.length >>> 0; if ("function" != typeof r) throw new TypeError(r + " is not a function"); for (arguments.length > 1 && (o = arguments[1]), t = 0; t < e;) { var i; t in n && (i = n[t], r.call(o, i, t, n)), t++ } }); document.addEventListener("DOMContentLoaded", function () { document.querySelectorAll(".mast-share").forEach(function (e, t) { e.querySelector(".mast-check-toggle").id = "mast-check-toggle-" + t, e.querySelector(".mast-check-label").htmlFor = "mast-check-toggle-" + t, e.querySelector(".mast-share-button").addEventListener("click", function (t) { var a = new RegExp("^(?:(?:https?|ftp)://)?(?:\\S+(?::\\S*)?@|\\d{1,3}(?:\\.\\d{1,3}){3}|(?:(?:[a-z\\d\\u00a1-\\uffff]+-?)*[a-z\\d\\u00a1-\\uffff]+)(?:\\.(?:[a-z\\d\\u00a1-\\uffff]+-?)*[a-z\\d\\u00a1-\\uffff]+)*(?:\\.[a-z\\u00a1-\\uffff]{2,6}))(?::\\d+)?(?:[^\\s]*)?$", "i"), n = e.querySelector('input[name="mast-instance-input"]'); if (a.test(n.value)) { var o = `http://${n.value.replace(/(^\w+:|^)\/\//, "")}/share?text=${encodeURIComponent(document.title)} ${encodeURIComponent(location.href)}`; window.open(o, "new", "toolbar=no,location=no,status=yes,resizable=yes,scrollbars=yes,height=600,width=400") } else n.classList.add("invalid"), setTimeout(function () { n.classList.remove("invalid") }, 300) }), e.addEventListener("mouseleave", function (t) { e.querySelector(".mast-check-toggle").checked = !1 }) }) });</script></li><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=The state of pattern matching in Java 17 by @deepu105 &url=https://deepu.tech/state-of-pattern-matching-java/" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1' title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/state-of-pattern-matching-java/" onclick='return window.open(this.href,"linkedin-share","width=550,height=435"),!1' title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/state-of-pattern-matching-java/&t=The state of pattern matching in Java 17" onclick='return window.open(this.href,"hackernews-share","width=550,height=435"),!1' title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/state-of-pattern-matching-java/&title=The state of pattern matching in Java 17" onclick='return window.open(this.href,"reddit-share","width=550,height=435"),!1' title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/state-of-pattern-matching-java/" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1' title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul></div></span></span></div></div></div><div class="article-post"><p>So what exactly is pattern matching?</p><blockquote><p>The act of checking a given sequence of tokens for the presence of the constituents of some pattern</p><ul><li>Wikipedia</li></ul></blockquote><p>Or simply put, itâ€™s a language feature where you can test for a specific pattern on a character sequence or a data structure. Pattern matching can be classified into two types.</p><ul><li><strong>Sequence patterns</strong>: pattern matching on character sequence or strings. Also known as our beloved Regular Expressions ðŸ˜‰ â€” I still wish I could write RegEx without cursing and looking up the syntax.</li><li><strong>Tree patterns</strong>: testing for patterns on a data structure. This is what we are going to talk about today.</li></ul><p><img src="https://i.imgur.com/M6xKDas.jpeg" alt="regex meme"></p><h2 id="why-pattern-matching">Why Pattern matching?</h2><p>Why do we need pattern matching? We donâ€™t, to be honest!</p><p>Pattern matching is not a requirement for a good programming language. Many of the most popular languages like JavaScript, Java, and Go get by just fine without it. But still, itâ€™s a great feature to have due to these advantages it offers</p><ul><li>Reduced cognitive complexity<ul><li>Much more concise code and better readability.</li><li>More complex logic can be expressed with fewer lines of code. While not very important, itâ€™s still a good thing.</li><li>Simpler to write and maintain.</li></ul></li><li>Reduced reliance on reflection and casting, especially in Java.</li><li>Avoid bugs caused by pattern dominance and pattern non-exhaustiveness.<ul><li>Pattern dominance is when a previous pattern supersedes another making it unreachable. A modern compiler should be able to catch it.</li><li>Pattern exhaustiveness is when the compiler warns you when you have not checked for all possible variants of a type, like having a case for all enum values or all subclasses of a type and so on.</li></ul></li></ul><p>Of course, these advantages depend on how a language implements pattern matching. So later, we will look at these from the perspective of Java.</p><h2 id="pattern-matching-features">Pattern matching features</h2><p>These are many languages that have great support for pattern matching. Rust and OCaml lead the pack here. On the JVM world, Scala also offers many of these pattern matching features. So when a language claims to have support for pattern matching, these are the features we expect:</p><ul><li>Enum matching in switch statements â€” Most languages, including Java, already does this</li><li>Match the value in switch/if statements â€” Common in any Turing complete language</li><li>Match type in switch/if statements â€” Required for pattern matching</li><li>Pattern matched variable assignments</li><li>Null checks â€” Required in a language like Java</li><li>Type guards</li><li>Refined patterns â€” If we can match for data types, then its logical to expect refining the pattern further using the matched type, which acts as a type guard</li><li>Pattern dominance and type exhaustion</li><li>Partial/Nested/Compound type and/or value checks</li><li>Shallow/Deep Position-based Destructured matching</li></ul><p>Itâ€™s not an exhaustive list but more of a general expectation to fulfill the previous advantages we saw.</p><h2 id="pattern-matching-in-java">Pattern matching in Java</h2><p>Unfortunately, Java is still a bit behind the curve when it comes to pattern matching.</p><p>But fortunately, we already have most of the building blocks required to achieve most of the features we saw earlier.</p><ul><li>Switch statements</li><li>Switch expressions (Java 14) â€” As compared to the switch statements, switch expressions can return a value, have multiple case labels on the same line, and need to be exhaustive. And hence can be used for variable assignments and statements without fallthrough</li><li>Pattern matching for <code class="language-plaintext highlighter-rouge">instanceof</code> (Java 16) â€” It can now pattern match data types, which means casting after a check is no longer required, and this can be used in <code class="language-plaintext highlighter-rouge">if</code> statements, assignments, and returns.</li><li>Sealed classes (Java 17)</li><li>Pattern matching for switch (Java 17 preview - JEP 406)</li></ul><p>Now let us look at some examples of what is already possible to do as of Java 17</p><h3 id="pattern-matching-for-instanceof">Pattern matching for <code class="language-plaintext highlighter-rouge">instanceof</code></h3><p>From Java 16 onwards, we can do pattern matching using the <code class="language-plaintext highlighter-rouge">instanceof</code> operator. It can be used on <code class="language-plaintext highlighter-rouge">if</code> statements, and we can use it as type guards on variable assignments and returns. This lets us use a variable without further casting after a type check. This is a new syntax added to the language.</p><p>Here we can see pattern matching using the <code class="language-plaintext highlighter-rouge">instanceof</code> operator in action. A type and a variable name follow the operator, and we can access the variable without further casting.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c1">// Before</span>

<span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">String</span><span class="o">)</span> <span class="o">{</span>
   <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">obj</span><span class="o">;</span>
   <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
<span class="o">}</span>

<span class="c1">// After</span>

<span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// Let pattern matching do the work!</span>
   <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>We can also use pattern matching as a type guard in returns and variable assignments. See how concise the code is when we do the return using a type guard instead of casting the type.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1">// Before</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(!(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Point</span><span class="o">))</span>
       <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
   <span class="nc">Point</span> <span class="n">other</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Point</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
   <span class="k">return</span> <span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span>
       <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// After</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Point</span> <span class="n">other</span><span class="o">)</span>
       <span class="o">&amp;&amp;</span> <span class="n">x</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">x</span>
       <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="na">y</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>Here is a variable assignment using a type guard. Again the code is much nicer with pattern matching.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c1">// Before</span>

<span class="kt">var</span> <span class="n">x</span> <span class="o">=</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Point</span> <span class="o">?</span> <span class="o">((</span><span class="nc">Point</span><span class="o">)</span><span class="n">o</span><span class="o">).</span><span class="na">x</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>

<span class="c1">// After</span>

<span class="kt">var</span> <span class="n">x</span> <span class="o">=</span> <span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Point</span> <span class="n">p</span> <span class="o">?</span> <span class="n">p</span><span class="o">.</span><span class="na">x</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">);</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>For a realistic use case, we could do something like below, when we want to do different logic based on the type, using the <code class="language-plaintext highlighter-rouge">instanceof</code> operator. But thatâ€™s a lot of if-else and cognitive load.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">static</span> <span class="nc">String</span> <span class="nf">formatter</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="nc">String</span> <span class="n">formatted</span> <span class="o">=</span> <span class="s">"unknown"</span><span class="o">;</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Integer</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">formatted</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"int %d"</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
   <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Long</span> <span class="n">l</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">formatted</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"long %d"</span><span class="o">,</span> <span class="n">l</span><span class="o">);</span>
   <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Double</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">formatted</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"double %f"</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
   <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">formatted</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"String %s"</span><span class="o">,</span> <span class="n">s</span><span class="o">);</span>
   <span class="o">}</span>
   <span class="k">return</span> <span class="n">formatted</span><span class="o">;</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><h3 id="pattern-matching-for-switch">Pattern matching for switch</h3><p>But with the new preview feature in Java 17, we can do pattern matching for data types in switch cases as well. For Both, switch statements and switch expressions.</p><p>This will let us rewrite the previous code using a switch expression like below. As you can see, this is also a new syntax. And itâ€™s similar to the one added to the <code class="language-plaintext highlighter-rouge">instanceof</code> operator.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">static</span> <span class="nc">String</span> <span class="nf">formatter</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"int %d"</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
       <span class="k">case</span> <span class="nc">Long</span> <span class="n">l</span>    <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"long %d"</span><span class="o">,</span> <span class="n">l</span><span class="o">);</span>
       <span class="k">case</span> <span class="nc">Double</span> <span class="n">d</span>  <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"double %f"</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
       <span class="k">case</span> <span class="nc">String</span> <span class="n">s</span>  <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"String %s"</span><span class="o">,</span> <span class="n">s</span><span class="o">);</span>
       <span class="k">default</span>        <span class="o">-&gt;</span> <span class="n">o</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
   <span class="o">};</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>This has Reduced cognitive complexity, and the syntax is closer to most other languages with pattern matching. With this, the compiler can warn us when pattern dominance occurs, as generic types should always come after specific types.</p><p>Since this is a preview feature, the syntax might change in future versions. I hope not, as I find this syntax nice in Java.</p><p>We can also do null checks in these switch cases, which makes pattern matching more useful in the case of Java.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">static</span> <span class="nc">String</span> <span class="nf">formatter</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">case</span> <span class="kc">null</span>      <span class="o">-&gt;</span> <span class="s">"Oops"</span><span class="o">;</span>
       <span class="o">...</span>
       <span class="k">case</span> <span class="nc">String</span> <span class="n">s</span>  <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"String %s"</span><span class="o">,</span> <span class="n">s</span><span class="o">);</span>
       <span class="k">default</span>        <span class="o">-&gt;</span> <span class="n">o</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
   <span class="o">};</span>
<span class="o">}</span>

<span class="c1">// or</span>

<span class="kd">static</span> <span class="nc">String</span> <span class="nf">formatter</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">{</span>
       <span class="o">...</span>
       <span class="k">case</span> <span class="nc">String</span> <span class="n">s</span>       <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"String %s"</span><span class="o">,</span> <span class="n">s</span><span class="o">);</span>
       <span class="k">case</span> <span class="kc">null</span><span class="o">,</span> <span class="k">default</span>  <span class="o">-&gt;</span> <span class="s">"Oops"</span><span class="o">;</span>
   <span class="o">};</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><h3 id="type-guards--pattern-refinement">Type Guards &amp; pattern refinement</h3><p>As we saw earlier, Type guards are already supported for <code class="language-plaintext highlighter-rouge">instanceof</code> operator from Java 16 onwards, and Java 17 preview adds that for switch cases as well. This means we can rely on the type guards to refine the patterns further to have conditions, relations, and value checks.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">((</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
   <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Not a string"</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Or</span>

<span class="kd">static</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">switch</span> <span class="o">(</span><span class="n">o</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">case</span> <span class="nc">String</span> <span class="n">s</span> <span class="o">&amp;&amp;</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="o">)</span>  <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span><span class="o">);</span>
       <span class="k">case</span> <span class="nc">String</span> <span class="n">s</span>                      <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Invalid string"</span><span class="o">);</span>
       <span class="k">default</span>                            <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Not a string"</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>While itâ€™s not as flexible as in Rust or OCaml, itâ€™s a good start, in my opinion.</p><h3 id="pattern-exhaustion-with-sealed-classes">Pattern exhaustion with Sealed classes</h3><p>We need to understand another new feature in Java 17, Sealed classes, to understand pattern exhaustion.</p><h4 id="sealed-classes">Sealed classes</h4><p>A sealed class lets you control which class can extend it. The same applies to sealed interfaces as well.</p><p>Permitted classes can be defined either as simple inner classes or in separate class files using the new <code class="language-plaintext highlighter-rouge">permits</code> keyword.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">abstract</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Shape</span>
  <span class="n">permits</span> <span class="nc">Circle</span><span class="o">,</span> <span class="nc">Rectangle</span><span class="o">,</span> <span class="nc">Square</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="c1">// Or</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Shape</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Circle</span> <span class="kd">extends</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Square</span> <span class="kd">extends</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">extends</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="o">}</span>

</pre></td></tr></tbody></table></code></pre></div></div><p>A sealed class imposes three constraints on its permitted sub-classes.</p><ol><li>A Sealed class and its permitted subclasses must be in the same module or the same package in case of an unnamed module.</li><li>Every permitted subclass must directly extend the sealed class.</li><li>Every permitted subclass must use a modifier to describe the propagation of sealing. Allowed modifiers are <code class="language-plaintext highlighter-rouge">final</code>, <code class="language-plaintext highlighter-rouge">sealed</code>, and <code class="language-plaintext highlighter-rouge">non-sealed</code>.<ul><li>Final subclasses cannot further be extended. Hence the class hierarchy ends with them. Records are implicitly final and hence do not need the keyword.</li><li>A Sealed subclass can further restrict class hierarchy with its own permitted subclasses, and the same three rules apply all over again for them</li><li>A Non-sealed subclass is a bit different. As the keyword suggests, it reverts to being open for extension by any class and breaks the class hierarchy rules set by the parent sealed class. Non-sealed sub-classes are still valid children and work well with other concepts. We will see that later.</li></ul></li></ol><blockquote><p>A fun fact, <code class="language-plaintext highlighter-rouge">non-sealed</code> is the first hyphenated keyword in Java.</p></blockquote><p>Here is how it would look in practice. Sealed classes can also be used with Records. Here the <code class="language-plaintext highlighter-rouge">Shape</code> interface is sealed, and it permits <code class="language-plaintext highlighter-rouge">Circle</code>, <code class="language-plaintext highlighter-rouge">Rectangle</code>, <code class="language-plaintext highlighter-rouge">Square</code>, and <code class="language-plaintext highlighter-rouge">WeirdShape</code> as subclasses.</p><p><code class="language-plaintext highlighter-rouge">Circle</code> is implicitly final as itâ€™s a record. <code class="language-plaintext highlighter-rouge">Square</code> is declared as final. And hence both cannot be extended further, and their hierarchy ends here.</p><p><code class="language-plaintext highlighter-rouge">Rectangle</code> is declared as sealed and permits only <code class="language-plaintext highlighter-rouge">TransparentRectangle</code> and <code class="language-plaintext highlighter-rouge">FilledRectangle</code> as subclasses. Hence Rectangleâ€™s class hierarchy can extend further, and <code class="language-plaintext highlighter-rouge">TransparentRectangle</code> and <code class="language-plaintext highlighter-rouge">FilledRectangle</code> can even define their own hierarchy.</p><p><code class="language-plaintext highlighter-rouge">WeirdShape</code> is declared as non-sealed and hence can be extended by any other class or record. Here the class hierarchy is wide open, and subclasses of a <code class="language-plaintext highlighter-rouge">WeirdClass</code> do not have to follow the rules of a sealed class. All instances of subclasses of <code class="language-plaintext highlighter-rouge">WeirdShape</code> will also be an instance of <code class="language-plaintext highlighter-rouge">WeirdShape,</code> and hence any code that checks for exhaustiveness of subtypes of <code class="language-plaintext highlighter-rouge">Shape</code> will still be valid.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">interface</span> <span class="nc">Shape</span>
   <span class="n">permits</span> <span class="nc">Circle</span><span class="o">,</span> <span class="nc">Rectangle</span><span class="o">,</span> <span class="nc">Square</span><span class="o">,</span> <span class="nc">WeirdShape</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="kd">public</span> <span class="n">record</span> <span class="nf">Circle</span><span class="o">(</span><span class="kt">int</span> <span class="n">r</span><span class="o">)</span> <span class="kd">implements</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Square</span> <span class="kd">implements</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Rectangle</span> <span class="kd">implements</span> <span class="nc">Shape</span>
   <span class="n">permits</span> <span class="nc">TransparentRectangle</span><span class="o">,</span> <span class="nc">FilledRectangle</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

<span class="kd">public</span> <span class="n">non</span><span class="o">-</span><span class="n">sealed</span> <span class="kd">class</span> <span class="nc">WeirdShape</span> <span class="kd">implements</span> <span class="nc">Shape</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>A sealed class can be abstract and can have abstract members, and similarly, sealed interfaces can have default implementations and so on. But abstract subclasses should be sealed or non-sealed and not final.</p><p>Extending a non-permitted class with a sealed class will be a compile-time error.</p><blockquote><p>Another fun fact: A combination of sealed classes and records is nothing but algebraic data types. (type formed by combining others, ex, Tuples, Records, unions)</p></blockquote><h4 id="pattern-exhaustion">Pattern exhaustion</h4><p>Remember pattern exhaustion we talked about? The java compiler cannot check for all possible variations for normal classes and hence would require us to add a default case to avoid missing paths in a switch expression, as switch expressions do not fall through and must be exhaustive in Java. That does not apply to switch statements as we can choose not to have a default case for them as they fall through.</p><p>But with sealed classes, the compiler knows exactly what the expected variants are. We can use this for exhaustive pattern matching. In that case, the compiler will warn when we miss a variant in the check without adding a default case. This is a much less error-prone and clearer approach. Even if the subclasses are non-sealed, the compiler will still do the exhaustiveness check.</p><p>See this example; if we use the same sealed classes we saw earlier in the first sample, we will get a compile-time error as we are not checking all variants of <code class="language-plaintext highlighter-rouge">Shape</code>, and there is no default case. In the second example, however, there is no error even without a default case as the compiler knows all possible variants of <code class="language-plaintext highlighter-rouge">Shape</code> have been accounted for. If we remove the <code class="language-plaintext highlighter-rouge">sealed</code> keyword for <code class="language-plaintext highlighter-rouge">Shape</code>, then the second sample will have the same error as there is no default case, and the compiler doesnâ€™t know about all variants of <code class="language-plaintext highlighter-rouge">Shape</code>.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nc">Shape</span> <span class="nf">rotate</span><span class="o">(</span><span class="nc">Shape</span> <span class="n">shape</span><span class="o">,</span> <span class="kt">double</span> <span class="n">angle</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">shape</span><span class="o">)</span> <span class="o">{</span>   <span class="c1">// this will be 'switch' expression does not cover all possible input values error</span>
       <span class="k">case</span> <span class="nc">Circle</span> <span class="n">c</span>    <span class="o">-&gt;</span> <span class="n">c</span><span class="o">;</span>
       <span class="k">case</span> <span class="nc">Square</span> <span class="n">s</span>    <span class="o">-&gt;</span> <span class="n">shape</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span>
   <span class="o">};</span>
<span class="o">}</span>

<span class="nc">Shape</span> <span class="nf">rotate</span><span class="o">(</span><span class="nc">Shape</span> <span class="n">shape</span><span class="o">,</span> <span class="kt">double</span> <span class="n">angle</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">shape</span><span class="o">)</span> <span class="o">{</span>
       <span class="k">case</span> <span class="nc">Circle</span> <span class="n">c</span>     <span class="o">-&gt;</span> <span class="n">c</span><span class="o">;</span>
       <span class="k">case</span> <span class="nc">Rectangle</span> <span class="n">r</span>  <span class="o">-&gt;</span> <span class="n">shape</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span>
       <span class="k">case</span> <span class="nc">Square</span> <span class="n">s</span>     <span class="o">-&gt;</span> <span class="n">shape</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span>
       <span class="k">case</span> <span class="nc">WeirdShape</span> <span class="n">w</span> <span class="o">-&gt;</span> <span class="n">shape</span><span class="o">.</span><span class="na">rotate</span><span class="o">(</span><span class="n">angle</span><span class="o">);</span> <span class="c1">// still exhaustive</span>
       <span class="c1">// no default needed!</span>
   <span class="o">};</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><h3 id="partial-patterns-and-destructing">Partial patterns and destructing</h3><p>There is a candidate feature to add preview for destructing/deconstruction syntax for the <code class="language-plaintext highlighter-rouge">instanceof</code> operator, so logically at some point, that should extend to the switch syntax as well. There are also talks about improving the feature further to add support for primitives in switch case patterns and to declare how it should be deconstructed at the class level so that normal classes can also be deconstructed.</p><h4 id="record-patterns--array-patterns-preview---jep-405">Record Patterns &amp; Array Patterns (Preview - JEP 405)</h4><p>So far, the only solid thing is the <a href="https://openjdk.java.net/jeps/405">candidate for deconstruction in instanceof operator</a>.</p><p>With this proposal, we should be able to deconstruct Records and Arrays. This is closer to how it works in Rust, for example. Look at how <code class="language-plaintext highlighter-rouge">Point</code> is deconstructed to its members, and we can directly use the members with type guard</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="n">record</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{}</span>

<span class="kt">void</span> <span class="nf">printSum</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">))</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>Deconstruction can be nested as well but doesnâ€™t have any facility for ignoring members like in other languages yet.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">record</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{}</span>
<span class="kd">enum</span> <span class="nc">Color</span> <span class="o">{</span> <span class="no">RED</span><span class="o">,</span> <span class="no">GREEN</span><span class="o">,</span> <span class="no">BLUE</span> <span class="o">}</span>
<span class="n">record</span> <span class="nf">ColoredPoint</span><span class="o">(</span><span class="nc">Point</span> <span class="n">p</span><span class="o">,</span> <span class="nc">Color</span> <span class="n">c</span><span class="o">)</span> <span class="o">{}</span>

<span class="kt">void</span> <span class="nf">printSum</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nf">ColoredPoint</span><span class="o">(</span><span class="nc">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">),</span> <span class="nc">Color</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>Array deconstruction is also proposed, and syntax is a bit similar to array deconstruction in JavaScript. Thankfully at least elements at the end can be ignored in this case; it would be pretty useless otherwise ðŸ˜‰</p><p>See how the string array is deconstructed to the first two elements with the rest ignored. The syntax is closer to the new array syntax as well.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">static</span> <span class="kt">void</span> <span class="nf">printFirstTwoStrings</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span> <span class="nc">String</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">s2</span><span class="o">,</span> <span class="o">...</span> <span class="o">}){</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s1</span> <span class="o">+</span> <span class="n">s2</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>Nested deconstruction is also possible for a mix of arrays and records. See how an array of <code class="language-plaintext highlighter-rouge">Points</code> are deconstructed here. And yes, <code class="language-plaintext highlighter-rouge">var</code> should work instead of type as well.</p><div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">static</span> <span class="kt">void</span> <span class="nf">printSumOfFirstTwoXCoords</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
   <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nc">Point</span><span class="o">[]</span> <span class="o">{</span> <span class="nc">Point</span><span class="o">(</span><span class="kt">var</span> <span class="n">x1</span><span class="o">,</span> <span class="kt">var</span> <span class="n">y1</span><span class="o">),</span> <span class="nc">Point</span><span class="o">(</span><span class="kt">var</span> <span class="n">x2</span><span class="o">,</span> <span class="kt">var</span> <span class="n">y2</span><span class="o">),</span> <span class="o">...</span> <span class="o">})</span> <span class="o">{</span>
       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">x1</span> <span class="o">+</span> <span class="n">x2</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>Of course, itâ€™s a baby step and not as powerful as deconstruction in Rust or JS, but I hope we get there, and even this baby step would make pattern matching much more powerful.</p><p>Hopefully, this would be extended to switch as well. That would make pattern matching in Java closer to complete, with only normal classes remaining to be accounted for. If the normal classes can specify how they should be deconstructed, that issue will be solved, and we will have powerful pattern matching in Java.</p><h1 id="conclusion">Conclusion</h1><p>So based on what we saw so far, the state of pattern matching in Java is as below.</p><ul><li>Enum matching in switch statements âœ…</li><li>Match type/value in switch statements âœ…</li><li>Match type/value in if statements âœ…</li><li>Pattern matched variable assignments âœ…</li><li>Null checks âœ…</li><li>Type guards âœ…</li><li>Refined patterns âœ…</li><li>Pattern dominance and type exhaustion ðŸ†—</li><li>Partial/Nested/Compound type and/or value checks ðŸ†—</li><li>Shallow/Deep Position-based Destructured matching ðŸ†—</li></ul><p>Most of the basic requirements are met with the <code class="language-plaintext highlighter-rouge">instanceof</code> operator pattern matching, and the Java 17 preview makes many other features possible. Of course, type exhaustion only works for sealed classes, and refined patterns are still quite basic, but the majority of the features for proper pattern matching are already available with the preview.</p><p>To summarize, these are the current and future limitations as far as we can see</p><p><strong>JDK 17 preview</strong></p><ul><li>No deconstruction</li><li>No nested patterns</li><li>Type exhaustion is only for sealed classes and enums</li><li>Pattern refinement is limited</li><li>Still a preview feature</li></ul><p><strong>JDK 18+ (maybe)</strong></p><ul><li>No deconstruction for classes and in switch cases</li><li>No nested patterns for classes and in switch cases</li><li>Type exhaustion is only for sealed classes and enums</li><li>No feature for ignoring donâ€™t-care patterns during deconstruction</li><li>No named patterns</li><li>Still a preview feature</li></ul><p>In a future version of Java, some of these limitations might be removed, at least for <code class="language-plaintext highlighter-rouge">instanceof</code> operator. We probably would still have to wait a few years before we can actually start using full-fledged pattern matching in production. Iâ€™ll update this post when more features are released.</p><hr><p>If you like this article, please leave a like or a comment.</p><p>You can follow me on <a href="https://twitter.com/deepu105">Twitter</a> and <a href="https://www.linkedin.com/in/deepu05/">LinkedIn</a>.</p><p>Cover image credit: Meme from <a href="https://makeameme.org/meme/patterns-patterns-everywhere-5c0a75">makeameme.org</a></p></div><hr><div class="after-post-cats"><ul class="tags mb-4"></ul></div><div class="after-post-tags"><ul class="tags"><li><a class="smoothscroll" href="/tags#java">#java</a></li><li><a class="smoothscroll" href="/tags#jdk">#jdk</a></li><li><a class="smoothscroll" href="/tags#openjdk">#openjdk</a></li><li><a class="smoothscroll" href="/tags#patternmatching">#patternmatching</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" href="/my-beautiful-linux-development-environment-2021/">&laquo; My sleek and modern Linux development machine in 2021</a> <a class="next d-block col-md-6 text-lg-right" href="/concurrency-in-modern-languages-final/">Concurrency in modern programming languages: Rust vs Go vs Java vs Node.js vs Deno vs .NET 6 &raquo;</a><div class="clearfix"></div></div><hr></div></div></div></div><div class="alertbar"><div class="container text-center"><span>Never miss a story from Technorage, follow me on <a rel="me" target="_blank" href="https://mastodon.social/@deepu105">Mastodon</a>, <a rel="me" target="_blank" href="https://www.linkedin.com/in/deepu05">Linkedin</a> or <a rel="me" target="_blank" href="https://twitter.com/deepu105">Twitter</a>.<br><small>This site uses Google Analytics which places <a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/cookie-usage#gtagjs_google_analytics_4_-_cookie_usage" target="_blank">few cookies</a>. By using the site, you agree to their use.</small></span></div></div></div><div class="jumbotron fortags lozad" data-background-image="/assets/images/jumbotron.jpg"><div class="d-md-flex h-100"><div class="col-md-4 transpdark align-self-center text-center h-100"><div class="d-md-flex align-items-center justify-content-center h-100"><h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">â†’</span></h2></div></div><div class="col-md-8 pt-1 ph-2 align-self-center text-center h-100"><a class="mt-1 mb-1" href="/tags#languages">languages (15)</a> <a class="mt-1 mb-1" href="/tags#programming">programming (15)</a> <a class="mt-1 mb-1" href="/tags#java">java (13)</a> <a class="mt-1 mb-1" href="/tags#javascript">javascript (13)</a> <a class="mt-1 mb-1" href="/tags#rust">rust (9)</a> <a class="mt-1 mb-1" href="/tags#beginners">beginners (8)</a> <a class="mt-1 mb-1" href="/tags#concurrency">concurrency (7)</a> <a class="mt-1 mb-1" href="/tags#go">go (7)</a> <a class="mt-1 mb-1" href="/tags#linux">linux (6)</a> <a class="mt-1 mb-1" href="/tags#kubernetes">kubernetes (5)</a> <a class="mt-1 mb-1" href="/tags#microservices">microservices (5)</a> <a class="mt-1 mb-1" href="/tags#typescript">typescript (5)</a> <a class="mt-1 mb-1" href="/tags#computerscience">computerscience (4)</a> <a class="mt-1 mb-1" href="/tags#development">development (4)</a> <a class="mt-1 mb-1" href="/tags#fedora">fedora (4)</a> <a class="mt-1 mb-1" href="/tags#functional">functional (4)</a> <a class="mt-1 mb-1" href="/tags#thepragmaticprogrammer">thepragmaticprogrammer (4)</a> <a class="mt-1 mb-1" href="/tags#async">async (3)</a> <a class="mt-1 mb-1" href="/tags#jhipster">jhipster (3)</a> <a class="mt-1 mb-1" href="/tags#azure">azure (2)</a> <a class="mt-1 mb-1" href="/tags#career">career (2)</a> <a class="mt-1 mb-1" href="/tags#codequality">codequality (2)</a> <a class="mt-1 mb-1" href="/tags#deno">deno (2)</a> <a class="mt-1 mb-1" href="/tags#devops">devops (2)</a> <a class="mt-1 mb-1" href="/tags#discuss">discuss (2)</a> <a class="mt-1 mb-1" href="/tags#docker">docker (2)</a> <a class="mt-1 mb-1" href="/tags#garbagecollection">garbagecollection (2)</a> <a class="mt-1 mb-1" href="/tags#gnome">gnome (2)</a> <a class="mt-1 mb-1" href="/tags#golang">golang (2)</a> <a class="mt-1 mb-1" href="/tags#kde">kde (2)</a> <a class="mt-1 mb-1" href="/tags#node">node (2)</a> <a class="mt-1 mb-1" href="/tags#nodejs">nodejs (2)</a> <a class="mt-1 mb-1" href="/tags#openjdk">openjdk (2)</a> <a class="mt-1 mb-1" href="/tags#passkeys">passkeys (2)</a> <a class="mt-1 mb-1" href="/tags#react">react (2)</a> <a class="mt-1 mb-1" href="/tags#showdev">showdev (2)</a> <a class="mt-1 mb-1" href="/tags#terminal">terminal (2)</a> <a class="mt-1 mb-1" href="/tags#terraform">terraform (2)</a> <a class="mt-1 mb-1" href="/tags#webassembly">webassembly (2)</a> <a class="mt-1 mb-1" href="/tags#webauthn">webauthn (2)</a> <a class="mt-1 mb-1" href="/tags#webdev">webdev (2)</a> <a class="mt-1 mb-1" href="/tags#architecture">architecture (1)</a> <a class="mt-1 mb-1" href="/tags#aws">aws (1)</a> <a class="mt-1 mb-1" href="/tags#bash">bash (1)</a> <a class="mt-1 mb-1" href="/tags#blogging">blogging (1)</a> <a class="mt-1 mb-1" href="/tags#books">books (1)</a> <a class="mt-1 mb-1" href="/tags#clojure">clojure (1)</a> <a class="mt-1 mb-1" href="/tags#codenewbie">codenewbie (1)</a> <a class="mt-1 mb-1" href="/tags#desktop">desktop (1)</a> <a class="mt-1 mb-1" href="/tags#developerexperience">developerexperience (1)</a> <a class="mt-1 mb-1" href="/tags#devrel">devrel (1)</a> <a class="mt-1 mb-1" href="/tags#devsecops">devsecops (1)</a> <a class="mt-1 mb-1" href="/tags#distributedsystems">distributedsystems (1)</a> <a class="mt-1 mb-1" href="/tags#engineering">engineering (1)</a> <a class="mt-1 mb-1" href="/tags#gaming">gaming (1)</a> <a class="mt-1 mb-1" href="/tags#ide">ide (1)</a> <a class="mt-1 mb-1" href="/tags#interview">interview (1)</a> <a class="mt-1 mb-1" href="/tags#istio">istio (1)</a> <a class="mt-1 mb-1" href="/tags#jdk">jdk (1)</a> <a class="mt-1 mb-1" href="/tags#Jekyll">Jekyll (1)</a> <a class="mt-1 mb-1" href="/tags#js">js (1)</a> <a class="mt-1 mb-1" href="/tags#jvm">jvm (1)</a> <a class="mt-1 mb-1" href="/tags#kotlin">kotlin (1)</a> <a class="mt-1 mb-1" href="/tags#loom">loom (1)</a> <a class="mt-1 mb-1" href="/tags#macos">macos (1)</a> <a class="mt-1 mb-1" href="/tags#mastodon">mastodon (1)</a> <a class="mt-1 mb-1" href="/tags#medium">medium (1)</a> <a class="mt-1 mb-1" href="/tags#memory-management">memory-management (1)</a> <a class="mt-1 mb-1" href="/tags#motivation">motivation (1)</a> <a class="mt-1 mb-1" href="/tags#multithreading">multithreading (1)</a> <a class="mt-1 mb-1" href="/tags#ohmyzsh">ohmyzsh (1)</a> <a class="mt-1 mb-1" href="/tags#opensource">opensource (1)</a> <a class="mt-1 mb-1" href="/tags#patternmatching">patternmatching (1)</a> <a class="mt-1 mb-1" href="/tags#polyglot">polyglot (1)</a> <a class="mt-1 mb-1" href="/tags#pragmatic">pragmatic (1)</a> <a class="mt-1 mb-1" href="/tags#python">python (1)</a> <a class="mt-1 mb-1" href="/tags#ruby">ruby (1)</a> <a class="mt-1 mb-1" href="/tags#scala">scala (1)</a> <a class="mt-1 mb-1" href="/tags#security">security (1)</a> <a class="mt-1 mb-1" href="/tags#social">social (1)</a> <a class="mt-1 mb-1" href="/tags#spring">spring (1)</a> <a class="mt-1 mb-1" href="/tags#svelte">svelte (1)</a> <a class="mt-1 mb-1" href="/tags#tech">tech (1)</a> <a class="mt-1 mb-1" href="/tags#ubuntu">ubuntu (1)</a> <a class="mt-1 mb-1" href="/tags#v8">v8 (1)</a> <a class="mt-1 mb-1" href="/tags#vr">vr (1)</a> <a class="mt-1 mb-1" href="/tags#vscode">vscode (1)</a> <a class="mt-1 mb-1" href="/tags#web">web (1)</a> <a class="mt-1 mb-1" href="/tags#windows">windows (1)</a> <a class="mt-1 mb-1" href="/tags#womenintech">womenintech (1)</a> <a class="mt-1 mb-1" href="/tags#writing">writing (1)</a> <a class="mt-1 mb-1" href="/tags#zsh">zsh (1)</a></div></div></div><footer class="footer"><div class="container"><div class="row"><div class="col-md-6 col-sm-6 text-center text-lg-left">Copyright Â© 2025 Deepu K Sasidharan<br><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img class="lozad" alt="Creative Commons License" style="border-width:0" src="/assets/images/placeholder.jpg" data-src="https://i.creativecommons.org/l/by/4.0/88x31.png"> </a>Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net | Domain by <a href="https://js.org" target="_blank" title="JS.ORG | JavaScript Community"><img src="/assets/images/placeholder.jpg" data-src="https://logo.js.org/dark_tiny.png" style="width:50px" alt="JS.ORG Logo" class="lozad"> </a>| Hosted with <i class="far fa-heart"></i> by <a href="https://pages.github.com/" target="_blank">Github</a></div></div></div></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js" integrity="sha256-34Si1Y6llMBKM3G0jQILVeoQKEwuxjbk4zGWXXMT4ps=" crossorigin="anonymous"></script><script async src="/assets/js/lunrsearchengine.js"></script><script async src="/assets/js/mediumish.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js" integrity="sha256-hstwhDmGVwZjIwt6SlTG6sQBREWrWTBjVTik/JLlb1Y=" crossorigin="anonymous"></script><script>// lazy loads images
    const lazyloadObserver = lozad()
    lazyloadObserver.observe();</script><script async src="/assets/js/ie10-viewport-bug-workaround.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1SDSM5NX07"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("consent","default",{ad_user_data:"denied",ad_personalization:"denied",ad_storage:"denied",analytics_storage:"granted"}),gtag("js",new Date),gtag("config","G-1SDSM5NX07")</script></body></html>