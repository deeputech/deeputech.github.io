<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel="icon" href="/assets/images/logo.png"><title>Concurrency in modern programming languages: Golang | Technorage</title><meta name="generator" content="Jekyll v4.1.1"><meta property="og:title" content="Concurrency in modern programming languages: Golang"><meta name="author" content="deepu"><meta property="og:locale" content="en_US"><meta name="description" content="Building a concurrent web server in Golang to compare concurrency performance with Rust, JS, TS, Kotlin, and Java"><meta property="og:description" content="Building a concurrent web server in Golang to compare concurrency performance with Rust, JS, TS, Kotlin, and Java"><link rel="canonical" href="https://deepu.tech/concurrency-in-modern-languages-go/"><meta property="og:url" content="https://deepu.tech/concurrency-in-modern-languages-go/"><meta property="og:site_name" content="Technorage"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-01-21T00:00:00+01:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Concurrency in modern programming languages: Golang"><script type="application/ld+json">{"headline":"Concurrency in modern programming languages: Golang","dateModified":"2021-01-21T00:00:00+01:00","datePublished":"2021-01-21T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://deepu.tech/concurrency-in-modern-languages-go/"},"url":"https://deepu.tech/concurrency-in-modern-languages-go/","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://deepu.tech/assets/images/logo.png"},"name":"deepu"},"author":{"@type":"Person","name":"deepu"},"description":"Building a concurrent web server in Golang to compare concurrency performance with Rust, JS, TS, Kotlin, and Java","@type":"BlogPosting","@context":"https://schema.org"}</script><link rel="canonical" href="https://deepu.tech/concurrency-in-modern-languages-go/"><meta property="og:url" content=""><meta name="monetization" content="$ilp.uphold.com/Aw7eGpxKNyK7"><meta name="twitter:site" content="@deepu105"><meta name="twitter:creator" content="@deepu105"><meta name="twitter:title" content="Concurrency in modern programming languages: Golang"><meta name="twitter:description" content="Building a concurrent web server in Golang to compare concurrency performance with Rust, JS, TS, Kotlin, and Java"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://i.imgur.com/ZTfXUBU.jpg"><link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y=" crossorigin="anonymous" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y=" crossorigin="anonymous"></noscript><link href="/assets/css/screen.css" rel="stylesheet"><link href="/assets/css/main.css" rel="stylesheet"></head><body class="layout-post"><noscript id="deferred-styles"><link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel="stylesheet"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css" crossorigin="anonymous"></noscript><nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down pr-md-0 pl-md-0"><div class="container d-flex align-items-center"><a class="navbar-brand" href="/"><h2 class="sitetitle">Technorage</h2><small class="sitetitlesub">Where I rage about technology and stuff! </small></a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarMediumish" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarMediumish"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link" href="/">About</a></li><li class="nav-item active"><a class="nav-link" href="/blogs/"><i class="fas fa-blog"></i> Blog</a></li><li class="nav-item"><a class="nav-link" href="/books"><i class="fas fa-book"></i> Books</a></li><li class="nav-item"><a class="nav-link" href="/appearances"><i class="fas fa-chalkboard-teacher"></i> Appearances</a></li><style>.lunrsearchresult .title{color:#d9230f}.lunrsearchresult .url{color:silver}.lunrsearchresult a{display:block;color:#777}.lunrsearchresult a:focus,.lunrsearchresult a:hover{text-decoration:none}.lunrsearchresult a:hover .title{text-decoration:underline}</style><form class="bd-search" onsubmit='return lunr_search(document.getElementById("lunrsearch").value)'><input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."></form><div id="lunrsearchresults"><ul></ul></div></ul></div></div></nav><div class="site-content"><div class="container"><div class="main-content"><div class="container mt-5"><div class="row"><div class="col-lg-2 pl-0"><div class="sticky-top sticky-top-offset"><div class="popover-wrapper d-none d-lg-block"><a href="#"><h2 class="popover-title"><i class="fas fa-stream fa-lg"></i> TOC</h2></a><div class="popover-content"><div class="toc lead"><h3 class="font-weight-bold">Summary</h3><ul><li><a href="#concurrency-in-go">Concurrency in Go</a><ul><li><a href="#multi-threading"><a href="https://golang.org/doc/effective_go.html#goroutines">Multi-threading</a></a></li><li><a href="#asynchronous-processing">Asynchronous processing</a></li></ul></li><li><a href="#benchmarking">Benchmarking</a><ul><li><a href="#tcp-concurrent-webserver">TCP concurrent webserver</a></li><li><a href="#http-concurrent-webserver">HTTP concurrent webserver</a></li></ul></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#references">References</a></li></ul></div></div></div><div class="share"><p>Share</p><ul><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=Concurrency in modern programming languages: Golang by @deepu105 &url=https://deepu.tech/concurrency-in-modern-languages-go/" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1' title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/concurrency-in-modern-languages-go/" onclick='return window.open(this.href,"linkedin-share","width=550,height=435"),!1' title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/concurrency-in-modern-languages-go/&t=Concurrency in modern programming languages: Golang" onclick='return window.open(this.href,"hackernews-share","width=550,height=435"),!1' title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/concurrency-in-modern-languages-go/&title=Concurrency in modern programming languages: Golang" onclick='return window.open(this.href,"reddit-share","width=550,height=435"),!1' title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/concurrency-in-modern-languages-go/" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1' title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul><div class="sep"></div><ul><li><script type="text/javascript">var HYVOR_TALK_WEBSITE=4123</script><script async type="text/javascript" src="//talk.hyvor.com/web-api/count/"></script><span data-talk-id="https://deepu.tech/concurrency-in-modern-languages-go/"></span></li></ul></div><div class="ad-vertical-md"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7ITK3I&placement=deeputech" id="_carbonads_js"></script></div></div></div><div class="col-lg-9 flex-first flex-lg-unordered"><div class="mainheading"><h1 class="posttitle">Concurrency in modern programming languages: Golang</h1><img data-src="https://i.imgur.com/ZTfXUBU.jpg" alt="Concurrency in modern programming languages: Golang" class="featured-image img-fluid lozad" src="/assets/images/placeholder.jpg"><div class="row post-top-meta"><div class="col-12 text-center text-md-left mb-4 mb-md-0"><img class="author-thumb lozad" src="/assets/images/placeholder.jpg" data-src="https://www.gravatar.com/avatar/7f408bc67dc9ae3b288ee92d16d3c4c2?s=250&d=mm&r=x" alt="Deepu K Sasidharan"> <a target="_blank" class="link-dark" href="https://www.deepu.tech">Deepu K Sasidharan</a><a target="_blank" href="https://twitter.com/deepu105" class="btn follow"><i class="fab fa-twitter"></i> Follow</a><span class="separator d-none d-md-inline-block">| </span><span class="author-description"><small><time class="post-date" datetime="2021-01-21">21 Jan 2021</time> </small><span class="separator d-inline-block">| </span><small>6 mins read </small><span class="separator d-inline-block d-lg-none">| </span><span class="d-inline-block d-lg-none"><div class="share" style="margin-top:0"><ul><li class="ml-1 mr-1"><a target="_blank" href="https://twitter.com/intent/tweet?text=Concurrency in modern programming languages: Golang by @deepu105 &url=https://deepu.tech/concurrency-in-modern-languages-go/" onclick='return window.open(this.href,"twitter-share","width=550,height=235"),!1' title="Twitter"><i class="fab fa-twitter"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://deepu.tech/concurrency-in-modern-languages-go/" onclick='return window.open(this.href,"linkedin-share","width=550,height=435"),!1' title="Linkedin"><i class="fab fa-linkedin-in"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://news.ycombinator.com/submitlink?u=https://deepu.tech/concurrency-in-modern-languages-go/&t=Concurrency in modern programming languages: Golang" onclick='return window.open(this.href,"hackernews-share","width=550,height=435"),!1' title="Hacker News"><i class="fab fa-hacker-news-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://www.reddit.com/submit?url=https://deepu.tech/concurrency-in-modern-languages-go/&title=Concurrency in modern programming languages: Golang" onclick='return window.open(this.href,"reddit-share","width=550,height=435"),!1' title="Reddit"><i class="fab fa-reddit-square"></i></a></li><li class="ml-1 mr-1"><a target="_blank" href="https://facebook.com/sharer.php?u=https://deepu.tech/concurrency-in-modern-languages-go/" onclick='return window.open(this.href,"facebook-share","width=550,height=435"),!1' title="Facebook"><i class="fab fa-facebook-f"></i></a></li></ul></div></span></span></div></div></div><div class="panel"><p><strong>This is part of my "concurrency in modern programming languages" series</strong></p><ol><li><a href="/concurrency-in-modern-languages/">Concurrency in modern programming languages: Introduction</a></li><li><a href="/concurrency-in-modern-languages-rust/">Concurrency in modern programming languages: Rust</a></li><li><strong>Concurrency in modern programming languages: Golang</strong></li><li><a href="/concurrency-in-modern-languages-js/">Concurrency in modern programming languages: JavaScript on NodeJS</a></li><li><a href="/concurrency-in-modern-languages-ts/">Concurrency in modern programming languages: TypeScript on Deno</a></li><li><a href="/concurrency-in-modern-languages-java/">Concurrency in modern programming languages: Java</a></li><li><a href="/concurrency-in-modern-languages-final/">Concurrency in modern programming languages: Rust vs Go vs Java vs Node.js vs Deno vs .NET 6</a></li></ol></div><div class="article-post"><p>This is a multi-part series where I’ll be talking about concurrency in modern programming languages and will be building and benchmarking a concurrent web server, inspired by the example from the <a href="https://doc.rust-lang.org/book/ch20-00-final-project-a-web-server.html">Rust book</a>, in popular languages like Rust, Go, JavaScript (NodeJS), TypeScript (Deno), Kotlin and Java to compare concurrency and its performance between these languages/platforms. The chapters of this series are as below.</p><ol><li><a href="https://deepu.tech/concurrency-in-modern-languages/">Introduction</a></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-rust/">Concurrent web server in Rust</a></li><li><strong>Concurrent web server in Golang</strong></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-js/">Concurrent web server in JavaScript with NodeJS</a></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-ts/">Concurrent web server in TypeScript with Deno</a></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-java/">Concurrent web server in Java with JVM</a></li><li><a href="https://deepu.tech/concurrency-in-modern-languages-final/">Comparison and conclusion of benchmarks</a></li></ol><hr><h2 id="concurrency-in-go">Concurrency in Go</h2><blockquote><p>Do not communicate by sharing memory; instead, share memory by communicating.</p><p>– Go docs</p></blockquote><p>Go supports concurrency as a first-class citizen with its <code class="language-plaintext highlighter-rouge">goroutines</code>. Go takes the concept of coroutines to a whole new level by making it much simpler and the preferred way of doing almost anything in Go. The semantic and syntax are made so easy that even a Go newbie will be able to start using <code class="language-plaintext highlighter-rouge">goroutines</code> from the get-go easily. All this without sacrificing performance.</p><p>While languages like Rust offers <a href="https://deepu.tech/concurrency-in-modern-languages-rust/">flexibility and power</a> over simplicity, Go focuses on simplicity and performance. While languages like Rust provide you with building blocks required for concurrency Go provides implementations that can be used easily to achieve most of the concurrency use cases. The Go standard library also uses goroutines where ever possible. This allows us to use goroutines and improve performance even for trivial use cases as there is not much overhead from the complexity of using concurrency semantics.</p><blockquote><p>The default for concurrency in Go is an asynchronous programming model and hence there are no explicit language features like async/await. Using concurrency with synchronous programming would be way more difficult in Go</p></blockquote><p>With Go, it’s possible to do multi-threaded concurrency and parallelization with goroutines and goroutines work in an asynchronous way hence making use of both multi-threading and asynchronous programming efficiently. It’s not as flexible as Rust as we saw in the <a href="https://deepu.tech/concurrency-in-modern-languages-rust/">previous chapter</a>, but still, you can achieve almost everything that is possible in Rust and still get the best possible performance for those use case.</p><h3 id="multi-threading"><a href="https://golang.org/doc/effective_go.html#goroutines">Multi-threading</a></h3><p>Multi-threading is achieved with goroutines that provide green threads (virtual threads that are scheduled by a runtime or virtual machine and not managed by the operating system) and there are no ways to use OS threads directly like in Rust for example. Go also provides implementations required for message-passing concurrency using <a href="https://golang.org/doc/effective_go.html#channels">channels</a> and shared-state concurrency using mutexes and WaitGroups, though Go discourages shared state concurrency. Parallelization is also possible using goroutines.</p><h3 id="asynchronous-processing">Asynchronous processing</h3><p>Technically asynchronous programming is not part of concurrency but in practice, it goes hand in hand for many use cases and improves performance, and makes resource usage more efficient. This is the default behavior in Go when using goroutines and hence there is no special syntax around these so synchronous programming with goroutines is not commonly done and would require using WaitGroups and such.</p><h2 id="benchmarking">Benchmarking</h2><p>Now that we have some basic understanding of concurrency features in Golang, let us build a simple concurrent web server in Go. Since goroutines are the only way to achieve this we’ll build two sample applications using the <code class="language-plaintext highlighter-rouge">http</code> package and plain <code class="language-plaintext highlighter-rouge">tcp</code>. The Go version used is the latest (1.15.6) at the time of writing.</p><h3 id="tcp-concurrent-webserver">TCP concurrent webserver</h3><p>This example is closer to the Rust Asynchronous example we built in the <a href="https://deepu.tech/concurrency-in-modern-languages-rust/">previous chapter</a>. I have omitted import statements for brevity. You can find the full example on <a href="https://github.com/deepu105/concurrency-benchmarks/tree/main/gows_tcp">GitHub here</a>. We are not using any external dependency in this case.</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">count</span> <span class="o">=</span> <span class="m">0</span>

	<span class="n">l</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">net</span><span class="o">.</span><span class="n">Listen</span><span class="p">(</span><span class="s">"tcp"</span><span class="p">,</span> <span class="s">"127.0.0.1:8080"</span><span class="p">)</span> <span class="c">// set listen port</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Error listening: "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">defer</span> <span class="n">l</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span> <span class="c">// close connection when done</span>

	<span class="k">for</span> <span class="p">{</span>
		<span class="n">count</span><span class="o">++</span>
		<span class="c">// Listen for an incoming connection.</span>
		<span class="k">if</span> <span class="n">conn</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">l</span><span class="o">.</span><span class="n">Accept</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
			<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Error accepting: "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="c">// Handle connections in a new goroutine.</span>
			<span class="k">go</span> <span class="n">handleConnection</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">handleConnection</span><span class="p">(</span><span class="n">conn</span> <span class="n">net</span><span class="o">.</span><span class="n">Conn</span><span class="p">,</span> <span class="n">count</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">// Close the connection when you're done with it.</span>
	<span class="k">defer</span> <span class="n">conn</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
	<span class="c">// Read the incoming connection into a buffer.</span>
	<span class="n">buf</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="m">1024</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">conn</span><span class="o">.</span><span class="n">Read</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"Error reading:"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="c">// add 2 second delay to every 10th request</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="m">10</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
		<span class="nb">println</span><span class="p">(</span><span class="s">"Adding delay. Count: "</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
		<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">2</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">html</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s">"hello.html"</span><span class="p">)</span> <span class="c">// read html file</span>
	<span class="c">// Send a response back</span>
	<span class="n">header</span> <span class="o">:=</span> <span class="s">`
HTTP/1.0 200 OK
Connection: keep-alive
Content-Length: 174
Content-Type: text/html; charset=utf-8
	`</span>
	<span class="n">res</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%s</span><span class="se">\r\n\r\n</span><span class="s">%s"</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="kt">string</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
	<span class="n">conn</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>As you can see we bind a TCP listener to port 8080 and listen to all incoming requests in an endless loop. Each request is processed in a new goroutine by using the <code class="language-plaintext highlighter-rouge">go</code> statement.</p><p>Let us run a benchmark using ApacheBench. We will make 10000 requests with 100 concurrent requests.</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre>ab <span class="nt">-c</span> 100 <span class="nt">-n</span> 10000 http://127.0.0.1:8080/

This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 1879490 <span class="nv">$&gt;</span>
...

Document Path:          /
Document Length:        174 bytes

Concurrency Level:      100
Time taken <span class="k">for </span>tests:   20.208 seconds
Complete requests:      10000
Failed requests:        0
Total transferred:      2780000 bytes
HTML transferred:       1740000 bytes
Requests per second:    494.86 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       202.075 <span class="o">[</span>ms] <span class="o">(</span>mean<span class="o">)</span>
Time per request:       2.021 <span class="o">[</span>ms] <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          134.35 <span class="o">[</span>Kbytes/sec] received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean[+/-sd] median   max
Connect:        0    1   1.0      0       9
Processing:     0  201 600.0      0    2012
Waiting:        0  201 600.0      0    2011
Total:          0  201 600.0      0    2015

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  50%      0
  66%      1
  75%      2
  80%      3
  90%   2000
  95%   2001
  98%   2001
  99%   2002
 100%   2015 <span class="o">(</span>longest request<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>Let’s see if there is a difference in performance when using the <code class="language-plaintext highlighter-rouge">http</code> package.</p><h3 id="http-concurrent-webserver">HTTP concurrent webserver</h3><p>This example is quite similar to the previous one except that we are using an HTTP server here and we are not invoking goroutines directly instead we pass a callback function to <code class="language-plaintext highlighter-rouge">http.HandleFunc</code> and it internally executes it as a goroutine. I have omitted import statements for brevity. You can find the full example on <a href="https://github.com/deepu105/concurrency-benchmarks/tree/main/gows">GitHub here</a>. We are not using any external dependency in this case as well and <code class="language-plaintext highlighter-rouge">http</code> is part of the Go standard library.</p><div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">count</span> <span class="o">=</span> <span class="m">0</span>
	<span class="c">// set router</span>
	<span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="n">r</span><span class="o">.</span><span class="n">Body</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
		<span class="n">count</span><span class="o">++</span>
		<span class="n">handleConnection</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
	<span class="p">})</span>
	<span class="c">// set listen port</span>
	<span class="n">err</span> <span class="o">:=</span> <span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s">":8080"</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
		<span class="n">log</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"ListenAndServe: "</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">handleConnection</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">count</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="c">// add 2 second delay to every 10th request</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">%</span> <span class="m">10</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
		<span class="nb">println</span><span class="p">(</span><span class="s">"Adding delay. Count: "</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
		<span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="m">2</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="n">html</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s">"hello.html"</span><span class="p">)</span> <span class="c">// read html file</span>
	<span class="n">w</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="s">"Connection"</span><span class="p">,</span> <span class="s">"keep-alive"</span><span class="p">)</span>
	<span class="n">w</span><span class="o">.</span><span class="n">WriteHeader</span><span class="p">(</span><span class="m">200</span><span class="p">)</span>           <span class="c">// 200 OK</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="kt">string</span><span class="p">(</span><span class="n">html</span><span class="p">))</span> <span class="c">// send data to client side</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>As you can see we created an HTTP server bound to port 8080 and listen to all incoming requests. We assign a callback function to handle each request which internally calls the <code class="language-plaintext highlighter-rouge">handleConnection</code> method. The code here is much more clean and concise compared to the previous one.</p><p>Let us run a benchmark using ApacheBench. We will make 10000 requests with 100 concurrent requests.</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre>ab <span class="nt">-c</span> 100 <span class="nt">-n</span> 10000 http://127.0.0.1:8080/

This is ApacheBench, Version 2.3 &lt;<span class="nv">$Revision</span>: 1879490 <span class="nv">$&gt;</span>
...

Document Path:          /
Document Length:        174 bytes

Concurrency Level:      100
Time taken <span class="k">for </span>tests:   20.232 seconds
Complete requests:      10000
Failed requests:        0
Total transferred:      2910000 bytes
HTML transferred:       1740000 bytes
Requests per second:    494.27 <span class="o">[</span><span class="c">#/sec] (mean)</span>
Time per request:       202.319 <span class="o">[</span>ms] <span class="o">(</span>mean<span class="o">)</span>
Time per request:       2.023 <span class="o">[</span>ms] <span class="o">(</span>mean, across all concurrent requests<span class="o">)</span>
Transfer rate:          140.46 <span class="o">[</span>Kbytes/sec] received

Connection Times <span class="o">(</span>ms<span class="o">)</span>
              min  mean[+/-sd] median   max
Connect:        0    1   0.9      0       6
Processing:     0  201 600.0      1    2013
Waiting:        0  201 600.0      0    2013
Total:          0  202 600.0      1    2018
WARNING: The median and mean <span class="k">for </span>the initial connection <span class="nb">time </span>are not within a normal deviation
        These results are probably not that reliable.

Percentage of the requests served within a certain <span class="nb">time</span> <span class="o">(</span>ms<span class="o">)</span>
  50%      1
  66%      1
  75%      2
  80%      3
  90%   2000
  95%   2001
  98%   2002
  99%   2003
 100%   2018 <span class="o">(</span>longest request<span class="o">)</span>
</pre></td></tr></tbody></table></code></pre></div></div><p>We got almost identical results here. So it might be preferable to just use the HTTP package for such use cases as it’s cleaner.</p><h2 id="conclusion">Conclusion</h2><p>As I explained in the <a href="https://deepu.tech/concurrency-in-modern-languages/">first part</a> of this serious, this simple benchmarking is not an accurate representation for all concurrency use cases. It’s a simple test for a very particular use case, a simple concurrent web server that just serves a file. The idea is to see the differences in solutions and to understand how concurrency works in Golang. And for this particular use case, the <code class="language-plaintext highlighter-rouge">http</code> package provided by the standard library does seem to be the best choice.</p><p>So stay tuned for the next post where we will look at concurrency in NodeJS and build the same use case in JavaScript.</p><hr><h2 id="references">References</h2><ul><li><a href="https://medium.com/@damithadayananda/golang-vs-java-concurrency-a-comparative-study-b0aea90f5fd7">medium.com/@damithadayananda</a></li><li><a href="https://medium.com/@gauravsingharoy/asynchronous-programming-with-go-546b96cd50c1">medium.com/@gauravsingharoy</a></li></ul><hr><p>If you like this article, please leave a like or a comment.</p><p>You can follow me on <a href="https://twitter.com/deepu105">Twitter</a> and <a href="https://www.linkedin.com/in/deepu05/">LinkedIn</a>.</p><p>Cover image credit: Photo by <a href="https://unsplash.com/@instagramfotografin?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Peggy Anke</a> on <a href="https://unsplash.com/s/photos/juggle?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p></div><hr><p>Post <strong>3</strong> of <strong>7</strong> in series <strong>"concurrency in modern programming languages"</strong>.</p><p></p><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" rel="prev" href="/concurrency-in-modern-languages-rust/">&laquo; Prev post in series</a> <a class="prev d-block col-md-6 text-right" rel="next" href="/concurrency-in-modern-languages-js/">Next post in series &raquo;</a><div class="clearfix"></div></div><div class="after-post-cats"><ul class="tags mb-4"></ul></div><div class="after-post-tags"><ul class="tags"><li><a class="smoothscroll" href="/tags#async">#async</a></li><li><a class="smoothscroll" href="/tags#concurrency">#concurrency</a></li><li><a class="smoothscroll" href="/tags#golang">#golang</a></li><li><a class="smoothscroll" href="/tags#languages">#languages</a></li></ul></div><div class="row PageNavigation d-flex justify-content-between font-weight-bold"><a class="prev d-block col-md-6" href="/concurrency-in-modern-languages-rust/">&laquo; Concurrency in modern programming languages: Rust</a> <a class="next d-block col-md-6 text-lg-right" href="/concurrency-in-modern-languages-js/">Concurrency in modern programming languages: JavaScript on NodeJS &raquo;</a><div class="clearfix"></div></div><hr></div></div></div><div class="container"><div id="comments" class="row justify-content-center mb-5"><div class="col-md-8"><section class="hyvor"><div id="hyvor-talk-view"></div><script type="text/javascript">var HYVOR_TALK_WEBSITE=4123,HYVOR_TALK_CONFIG={url:"https://deepu.tech/concurrency-in-modern-languages-go/",id:"https://deepu.tech/concurrency-in-modern-languages-go/"}</script><script async type="text/javascript" src="//talk.hyvor.com/web-api/embed"></script></section></div></div></div></div><div class="alertbar"><div class="container text-center"><span>Never miss a <b>story</b> from us, subscribe to our newsletter</span><form action="https://tech.us7.list-manage.com/subscribe/post?u=00729f6c6d6bb180801b9484e&amp;id=f521dede4b" method="post" name="mc-embedded-subscribe-form" id="mc-embedded-subscribe-form" class="wj-contact-form validate" target="_blank" novalidate><div class="mc-field-group"><input type="email" placeholder="Email address" name="EMAIL" class="required email" id="mce-EMAIL" autocomplete="on" required> <input type="submit" value="Subscribe" name="subscribe" class="heart"></div></form></div></div></div><div class="jumbotron fortags lozad" data-background-image="/assets/images/jumbotron.jpg"><div class="d-md-flex h-100"><div class="col-md-4 transpdark align-self-center text-center h-100"><div class="d-md-flex align-items-center justify-content-center h-100"><h2 class="d-md-block align-self-center py-1 font-weight-light">Explore <span class="d-none d-md-inline">→</span></h2></div></div><div class="col-md-8 pt-1 ph-2 align-self-center text-center h-100"><a class="mt-1 mb-1" href="/tags#languages">languages (15)</a> <a class="mt-1 mb-1" href="/tags#programming">programming (15)</a> <a class="mt-1 mb-1" href="/tags#javascript">javascript (13)</a> <a class="mt-1 mb-1" href="/tags#java">java (11)</a> <a class="mt-1 mb-1" href="/tags#rust">rust (9)</a> <a class="mt-1 mb-1" href="/tags#beginners">beginners (8)</a> <a class="mt-1 mb-1" href="/tags#concurrency">concurrency (7)</a> <a class="mt-1 mb-1" href="/tags#go">go (7)</a> <a class="mt-1 mb-1" href="/tags#linux">linux (6)</a> <a class="mt-1 mb-1" href="/tags#microservices">microservices (5)</a> <a class="mt-1 mb-1" href="/tags#typescript">typescript (5)</a> <a class="mt-1 mb-1" href="/tags#computerscience">computerscience (4)</a> <a class="mt-1 mb-1" href="/tags#development">development (4)</a> <a class="mt-1 mb-1" href="/tags#fedora">fedora (4)</a> <a class="mt-1 mb-1" href="/tags#functional">functional (4)</a> <a class="mt-1 mb-1" href="/tags#thepragmaticprogrammer">thepragmaticprogrammer (4)</a> <a class="mt-1 mb-1" href="/tags#async">async (3)</a> <a class="mt-1 mb-1" href="/tags#jhipster">jhipster (3)</a> <a class="mt-1 mb-1" href="/tags#kubernetes">kubernetes (3)</a> <a class="mt-1 mb-1" href="/tags#azure">azure (2)</a> <a class="mt-1 mb-1" href="/tags#career">career (2)</a> <a class="mt-1 mb-1" href="/tags#codequality">codequality (2)</a> <a class="mt-1 mb-1" href="/tags#deno">deno (2)</a> <a class="mt-1 mb-1" href="/tags#discuss">discuss (2)</a> <a class="mt-1 mb-1" href="/tags#docker">docker (2)</a> <a class="mt-1 mb-1" href="/tags#garbagecollection">garbagecollection (2)</a> <a class="mt-1 mb-1" href="/tags#gnome">gnome (2)</a> <a class="mt-1 mb-1" href="/tags#golang">golang (2)</a> <a class="mt-1 mb-1" href="/tags#kde">kde (2)</a> <a class="mt-1 mb-1" href="/tags#node">node (2)</a> <a class="mt-1 mb-1" href="/tags#nodejs">nodejs (2)</a> <a class="mt-1 mb-1" href="/tags#openjdk">openjdk (2)</a> <a class="mt-1 mb-1" href="/tags#react">react (2)</a> <a class="mt-1 mb-1" href="/tags#showdev">showdev (2)</a> <a class="mt-1 mb-1" href="/tags#terminal">terminal (2)</a> <a class="mt-1 mb-1" href="/tags#webassembly">webassembly (2)</a> <a class="mt-1 mb-1" href="/tags#webdev">webdev (2)</a> <a class="mt-1 mb-1" href="/tags#architecture">architecture (1)</a> <a class="mt-1 mb-1" href="/tags#bash">bash (1)</a> <a class="mt-1 mb-1" href="/tags#blogging">blogging (1)</a> <a class="mt-1 mb-1" href="/tags#books">books (1)</a> <a class="mt-1 mb-1" href="/tags#clojure">clojure (1)</a> <a class="mt-1 mb-1" href="/tags#codenewbie">codenewbie (1)</a> <a class="mt-1 mb-1" href="/tags#desktop">desktop (1)</a> <a class="mt-1 mb-1" href="/tags#developerexperience">developerexperience (1)</a> <a class="mt-1 mb-1" href="/tags#devops">devops (1)</a> <a class="mt-1 mb-1" href="/tags#devrel">devrel (1)</a> <a class="mt-1 mb-1" href="/tags#distributedsystems">distributedsystems (1)</a> <a class="mt-1 mb-1" href="/tags#engineering">engineering (1)</a> <a class="mt-1 mb-1" href="/tags#gaming">gaming (1)</a> <a class="mt-1 mb-1" href="/tags#ide">ide (1)</a> <a class="mt-1 mb-1" href="/tags#interview">interview (1)</a> <a class="mt-1 mb-1" href="/tags#istio">istio (1)</a> <a class="mt-1 mb-1" href="/tags#jdk">jdk (1)</a> <a class="mt-1 mb-1" href="/tags#Jekyll">Jekyll (1)</a> <a class="mt-1 mb-1" href="/tags#js">js (1)</a> <a class="mt-1 mb-1" href="/tags#jvm">jvm (1)</a> <a class="mt-1 mb-1" href="/tags#kotlin">kotlin (1)</a> <a class="mt-1 mb-1" href="/tags#loom">loom (1)</a> <a class="mt-1 mb-1" href="/tags#macos">macos (1)</a> <a class="mt-1 mb-1" href="/tags#medium">medium (1)</a> <a class="mt-1 mb-1" href="/tags#memory-management">memory-management (1)</a> <a class="mt-1 mb-1" href="/tags#motivation">motivation (1)</a> <a class="mt-1 mb-1" href="/tags#multithreading">multithreading (1)</a> <a class="mt-1 mb-1" href="/tags#ohmyzsh">ohmyzsh (1)</a> <a class="mt-1 mb-1" href="/tags#opensource">opensource (1)</a> <a class="mt-1 mb-1" href="/tags#patternmatching">patternmatching (1)</a> <a class="mt-1 mb-1" href="/tags#polyglot">polyglot (1)</a> <a class="mt-1 mb-1" href="/tags#pragmatic">pragmatic (1)</a> <a class="mt-1 mb-1" href="/tags#python">python (1)</a> <a class="mt-1 mb-1" href="/tags#ruby">ruby (1)</a> <a class="mt-1 mb-1" href="/tags#scala">scala (1)</a> <a class="mt-1 mb-1" href="/tags#svelte">svelte (1)</a> <a class="mt-1 mb-1" href="/tags#tech">tech (1)</a> <a class="mt-1 mb-1" href="/tags#terraform">terraform (1)</a> <a class="mt-1 mb-1" href="/tags#ubuntu">ubuntu (1)</a> <a class="mt-1 mb-1" href="/tags#v8">v8 (1)</a> <a class="mt-1 mb-1" href="/tags#vr">vr (1)</a> <a class="mt-1 mb-1" href="/tags#vscode">vscode (1)</a> <a class="mt-1 mb-1" href="/tags#web">web (1)</a> <a class="mt-1 mb-1" href="/tags#windows">windows (1)</a> <a class="mt-1 mb-1" href="/tags#womenintech">womenintech (1)</a> <a class="mt-1 mb-1" href="/tags#writing">writing (1)</a> <a class="mt-1 mb-1" href="/tags#zsh">zsh (1)</a></div></div></div><footer class="footer"><div class="container"><div class="row"><div class="col-md-6 col-sm-6 text-center text-lg-left">Copyright © 2022 Deepu K Sasidharan<br><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img class="lozad" alt="Creative Commons License" style="border-width:0" src="/assets/images/placeholder.jpg" data-src="https://i.creativecommons.org/l/by/4.0/88x31.png"> </a>Content licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</div><div class="col-md-6 col-sm-6 text-center text-lg-right"><a target="_blank" href="https://www.wowthemes.net/mediumish-free-jekyll-template/">Mediumish Jekyll Theme</a> by WowThemes.net | Domain by <a href="https://js.org" target="_blank" title="JS.ORG | JavaScript Community"><img src="/assets/images/placeholder.jpg" data-src="https://logo.js.org/dark_tiny.png" style="width:50px" alt="JS.ORG Logo" class="lozad"> </a>| Hosted with <i class="far fa-heart"></i> by <a href="https://pages.github.com/" target="_blank">Github</a></div></div></div></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.8/lunr.min.js" integrity="sha256-34Si1Y6llMBKM3G0jQILVeoQKEwuxjbk4zGWXXMT4ps=" crossorigin="anonymous"></script><script async src="/assets/js/lunrsearchengine.js"></script><script async src="/assets/js/mediumish.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.14.0/lozad.min.js" integrity="sha256-hstwhDmGVwZjIwt6SlTG6sQBREWrWTBjVTik/JLlb1Y=" crossorigin="anonymous"></script><script>// lazy loads images
        const lazyloadObserver = lozad()
        lazyloadObserver.observe();</script><script async src="/assets/js/ie10-viewport-bug-workaround.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-74370272-6"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-74370272-6")</script></body></html>